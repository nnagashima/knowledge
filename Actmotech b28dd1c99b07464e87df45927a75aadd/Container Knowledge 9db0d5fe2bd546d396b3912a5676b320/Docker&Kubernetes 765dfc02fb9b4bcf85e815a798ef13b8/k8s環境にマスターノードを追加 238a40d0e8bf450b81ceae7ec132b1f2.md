# k8s環境にマスターノードを追加

![kubernetes-icon-2048x1995-r1q3f8n7.png](k8s%E7%92%B0%E5%A2%83%E3%81%AB%E3%83%9E%E3%82%B9%E3%82%BF%E3%83%BC%E3%83%8E%E3%83%BC%E3%83%88%E3%82%99%E3%82%92%E8%BF%BD%E5%8A%A0%20238a40d0e8bf450b81ceae7ec132b1f2/kubernetes-icon-2048x1995-r1q3f8n7.png)

目次

# はじめに

---

既存のk8s環境にマスターノードを追加する手順になります。

# **証明書とトークンの再作成**

---

以下コマンドで再発行します。

kubeadm token はWorker追加時と同じコマンドになります。

```bash
# kubeadm init phase upload-certs --upload-certs
[upload-certs] Storing the certificates in Secret "kubeadm-certs" in the "kube-system" Namespace
[upload-certs] Using certificate key:
668d82459178ef08bed3f83ed21f60655913bbc9eabc73dc7c2f311ed9d861eb

# kubeadm token create --print-join-command
kubeadm join 192.168.11.11:6443 --token kj1ni6.rvm19fftj7aji1r4 --discovery-token-ca-cert-hash sha256:9e808dff984d9ff3bcf2a65174ce06cc55460259850cba711c5ef267c5b190c1
```

# マスターノードを追加

---

再発行した証明書とトークンを使ってマスターノードを追加します。

```bash
# kubeadm join 192.168.11.11:6443 --token kj1ni6.rvm19fftj7aji1r4 \
--discovery-token-ca-cert-hash sha256:9e808dff984d9ff3bcf2a65174ce06cc55460259850cba711c5ef267c5b190c1 \
--control-plane --certificate-key 668d82459178ef08bed3f83ed21f60655913bbc9eabc73dc7c2f311ed9d861eb
```

追加後、以下を実行します。

```bash
# mkdir -p $HOME/.kube
# sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
# sudo chown $(id -u):$(id -g) $HOME/.kube/config
```

ノードが追加されてることを確認

```bash
NAME               STATUS   ROLES           AGE     VERSION
ray-k8s-master01   Ready    control-plane   18d     v1.26.0
ray-k8s-master02   Ready    control-plane   18d     v1.26.0
ray-k8s-master03   Ready    control-plane   18d     v1.26.0
ray-k8s-master04   Ready    control-plane   11m     v1.26.0
ray-k8s-master05   Ready    control-plane   9m55s   v1.26.0
ray-k8s-worker01   Ready    <none>          18d     v1.26.0
ray-k8s-worker02   Ready    <none>          18d     v1.26.0
ray-k8s-worker03   Ready    <none>          18d     v1.26.0
```