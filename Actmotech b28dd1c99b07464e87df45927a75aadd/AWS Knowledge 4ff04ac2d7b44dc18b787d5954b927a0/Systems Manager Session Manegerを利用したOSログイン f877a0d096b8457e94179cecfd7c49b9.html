<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>Systems Manager Session Manegerを利用したOSログイン</title><style>
/* cspell:disable-file */
/* webkit printing magic: print all background colors */
html {
	-webkit-print-color-adjust: exact;
}
* {
	box-sizing: border-box;
	-webkit-print-color-adjust: exact;
}

html,
body {
	margin: 0;
	padding: 0;
}
@media only screen {
	body {
		margin: 2em auto;
		max-width: 900px;
		color: rgb(55, 53, 47);
	}
}

body {
	line-height: 1.5;
	white-space: pre-wrap;
}

a,
a.visited {
	color: inherit;
	text-decoration: underline;
}

.pdf-relative-link-path {
	font-size: 80%;
	color: #444;
}

h1,
h2,
h3 {
	letter-spacing: -0.01em;
	line-height: 1.2;
	font-weight: 600;
	margin-bottom: 0;
}

.page-title {
	font-size: 2.5rem;
	font-weight: 700;
	margin-top: 0;
	margin-bottom: 0.75em;
}

h1 {
	font-size: 1.875rem;
	margin-top: 1.875rem;
}

h2 {
	font-size: 1.5rem;
	margin-top: 1.5rem;
}

h3 {
	font-size: 1.25rem;
	margin-top: 1.25rem;
}

.source {
	border: 1px solid #ddd;
	border-radius: 3px;
	padding: 1.5em;
	word-break: break-all;
}

.callout {
	border-radius: 3px;
	padding: 1rem;
}

figure {
	margin: 1.25em 0;
	page-break-inside: avoid;
}

figcaption {
	opacity: 0.5;
	font-size: 85%;
	margin-top: 0.5em;
}

mark {
	background-color: transparent;
}

.indented {
	padding-left: 1.5em;
}

hr {
	background: transparent;
	display: block;
	width: 100%;
	height: 1px;
	visibility: visible;
	border: none;
	border-bottom: 1px solid rgba(55, 53, 47, 0.09);
}

img {
	max-width: 100%;
}

@media only print {
	img {
		max-height: 100vh;
		object-fit: contain;
	}
}

@page {
	margin: 1in;
}

.collection-content {
	font-size: 0.875rem;
}

.column-list {
	display: flex;
	justify-content: space-between;
}

.column {
	padding: 0 1em;
}

.column:first-child {
	padding-left: 0;
}

.column:last-child {
	padding-right: 0;
}

.table_of_contents-item {
	display: block;
	font-size: 0.875rem;
	line-height: 1.3;
	padding: 0.125rem;
}

.table_of_contents-indent-1 {
	margin-left: 1.5rem;
}

.table_of_contents-indent-2 {
	margin-left: 3rem;
}

.table_of_contents-indent-3 {
	margin-left: 4.5rem;
}

.table_of_contents-link {
	text-decoration: none;
	opacity: 0.7;
	border-bottom: 1px solid rgba(55, 53, 47, 0.18);
}

table,
th,
td {
	border: 1px solid rgba(55, 53, 47, 0.09);
	border-collapse: collapse;
}

table {
	border-left: none;
	border-right: none;
}

th,
td {
	font-weight: normal;
	padding: 0.25em 0.5em;
	line-height: 1.5;
	min-height: 1.5em;
	text-align: left;
}

th {
	color: rgba(55, 53, 47, 0.6);
}

ol,
ul {
	margin: 0;
	margin-block-start: 0.6em;
	margin-block-end: 0.6em;
}

li > ol:first-child,
li > ul:first-child {
	margin-block-start: 0.6em;
}

ul > li {
	list-style: disc;
}

ul.to-do-list {
	padding-inline-start: 0;
}

ul.to-do-list > li {
	list-style: none;
}

.to-do-children-checked {
	text-decoration: line-through;
	opacity: 0.375;
}

ul.toggle > li {
	list-style: none;
}

ul {
	padding-inline-start: 1.7em;
}

ul > li {
	padding-left: 0.1em;
}

ol {
	padding-inline-start: 1.6em;
}

ol > li {
	padding-left: 0.2em;
}

.mono ol {
	padding-inline-start: 2em;
}

.mono ol > li {
	text-indent: -0.4em;
}

.toggle {
	padding-inline-start: 0em;
	list-style-type: none;
}

/* Indent toggle children */
.toggle > li > details {
	padding-left: 1.7em;
}

.toggle > li > details > summary {
	margin-left: -1.1em;
}

.selected-value {
	display: inline-block;
	padding: 0 0.5em;
	background: rgba(206, 205, 202, 0.5);
	border-radius: 3px;
	margin-right: 0.5em;
	margin-top: 0.3em;
	margin-bottom: 0.3em;
	white-space: nowrap;
}

.collection-title {
	display: inline-block;
	margin-right: 1em;
}

.page-description {
    margin-bottom: 2em;
}

.simple-table {
	margin-top: 1em;
	font-size: 0.875rem;
	empty-cells: show;
}
.simple-table td {
	height: 29px;
	min-width: 120px;
}

.simple-table th {
	height: 29px;
	min-width: 120px;
}

.simple-table-header-color {
	background: rgb(247, 246, 243);
	color: black;
}
.simple-table-header {
	font-weight: 500;
}

time {
	opacity: 0.5;
}

.icon {
	display: inline-block;
	max-width: 1.2em;
	max-height: 1.2em;
	text-decoration: none;
	vertical-align: text-bottom;
	margin-right: 0.5em;
}

img.icon {
	border-radius: 3px;
}

.user-icon {
	width: 1.5em;
	height: 1.5em;
	border-radius: 100%;
	margin-right: 0.5rem;
}

.user-icon-inner {
	font-size: 0.8em;
}

.text-icon {
	border: 1px solid #000;
	text-align: center;
}

.page-cover-image {
	display: block;
	object-fit: cover;
	width: 100%;
	max-height: 30vh;
}

.page-header-icon {
	font-size: 3rem;
	margin-bottom: 1rem;
}

.page-header-icon-with-cover {
	margin-top: -0.72em;
	margin-left: 0.07em;
}

.page-header-icon img {
	border-radius: 3px;
}

.link-to-page {
	margin: 1em 0;
	padding: 0;
	border: none;
	font-weight: 500;
}

p > .user {
	opacity: 0.5;
}

td > .user,
td > time {
	white-space: nowrap;
}

input[type="checkbox"] {
	transform: scale(1.5);
	margin-right: 0.6em;
	vertical-align: middle;
}

p {
	margin-top: 0.5em;
	margin-bottom: 0.5em;
}

.image {
	border: none;
	margin: 1.5em 0;
	padding: 0;
	border-radius: 0;
	text-align: center;
}

.code,
code {
	background: rgba(135, 131, 120, 0.15);
	border-radius: 3px;
	padding: 0.2em 0.4em;
	border-radius: 3px;
	font-size: 85%;
	tab-size: 2;
}

code {
	color: #eb5757;
}

.code {
	padding: 1.5em 1em;
}

.code-wrap {
	white-space: pre-wrap;
	word-break: break-all;
}

.code > code {
	background: none;
	padding: 0;
	font-size: 100%;
	color: inherit;
}

blockquote {
	font-size: 1.25em;
	margin: 1em 0;
	padding-left: 1em;
	border-left: 3px solid rgb(55, 53, 47);
}

.bookmark {
	text-decoration: none;
	max-height: 8em;
	padding: 0;
	display: flex;
	width: 100%;
	align-items: stretch;
}

.bookmark-title {
	font-size: 0.85em;
	overflow: hidden;
	text-overflow: ellipsis;
	height: 1.75em;
	white-space: nowrap;
}

.bookmark-text {
	display: flex;
	flex-direction: column;
}

.bookmark-info {
	flex: 4 1 180px;
	padding: 12px 14px 14px;
	display: flex;
	flex-direction: column;
	justify-content: space-between;
}

.bookmark-image {
	width: 33%;
	flex: 1 1 180px;
	display: block;
	position: relative;
	object-fit: cover;
	border-radius: 1px;
}

.bookmark-description {
	color: rgba(55, 53, 47, 0.6);
	font-size: 0.75em;
	overflow: hidden;
	max-height: 4.5em;
	word-break: break-word;
}

.bookmark-href {
	font-size: 0.75em;
	margin-top: 0.25em;
}

.sans { font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; }
.code { font-family: "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace; }
.serif { font-family: Lyon-Text, Georgia, ui-serif, serif; }
.mono { font-family: iawriter-mono, Nitti, Menlo, Courier, monospace; }
.pdf .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK JP'; }
.pdf:lang(zh-CN) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC'; }
.pdf:lang(zh-TW) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK TC'; }
.pdf:lang(ko-KR) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK KR'; }
.pdf .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.pdf .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK JP'; }
.pdf:lang(zh-CN) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK SC'; }
.pdf:lang(zh-TW) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK TC'; }
.pdf:lang(ko-KR) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK KR'; }
.pdf .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.highlight-default {
	color: rgba(55, 53, 47, 1);
}
.highlight-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.highlight-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.highlight-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.highlight-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.highlight-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.highlight-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.highlight-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.highlight-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.highlight-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.highlight-default_background {
	color: rgba(55, 53, 47, 1);
}
.highlight-gray_background {
	background: rgba(241, 241, 239, 1);
}
.highlight-brown_background {
	background: rgba(244, 238, 238, 1);
}
.highlight-orange_background {
	background: rgba(251, 236, 221, 1);
}
.highlight-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.highlight-teal_background {
	background: rgba(237, 243, 236, 1);
}
.highlight-blue_background {
	background: rgba(231, 243, 248, 1);
}
.highlight-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.highlight-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.highlight-red_background {
	background: rgba(253, 235, 236, 1);
}
.block-color-default {
	color: inherit;
	fill: inherit;
}
.block-color-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.block-color-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.block-color-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.block-color-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.block-color-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.block-color-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.block-color-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.block-color-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.block-color-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.block-color-default_background {
	color: inherit;
	fill: inherit;
}
.block-color-gray_background {
	background: rgba(241, 241, 239, 1);
}
.block-color-brown_background {
	background: rgba(244, 238, 238, 1);
}
.block-color-orange_background {
	background: rgba(251, 236, 221, 1);
}
.block-color-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.block-color-teal_background {
	background: rgba(237, 243, 236, 1);
}
.block-color-blue_background {
	background: rgba(231, 243, 248, 1);
}
.block-color-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.block-color-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.block-color-red_background {
	background: rgba(253, 235, 236, 1);
}
.select-value-color-uiBlue { background-color: rgba(35, 131, 226, .07); }
.select-value-color-pink { background-color: rgba(245, 224, 233, 1); }
.select-value-color-purple { background-color: rgba(232, 222, 238, 1); }
.select-value-color-green { background-color: rgba(219, 237, 219, 1); }
.select-value-color-gray { background-color: rgba(227, 226, 224, 1); }
.select-value-color-transparentGray { background-color: rgba(227, 226, 224, 0); }
.select-value-color-translucentGray { background-color: rgba(0, 0, 0, 0.06); }
.select-value-color-orange { background-color: rgba(250, 222, 201, 1); }
.select-value-color-brown { background-color: rgba(238, 224, 218, 1); }
.select-value-color-red { background-color: rgba(255, 226, 221, 1); }
.select-value-color-yellow { background-color: rgba(253, 236, 200, 1); }
.select-value-color-blue { background-color: rgba(211, 229, 239, 1); }
.select-value-color-pageGlass { background-color: undefined; }
.select-value-color-washGlass { background-color: undefined; }

.checkbox {
	display: inline-flex;
	vertical-align: text-bottom;
	width: 16;
	height: 16;
	background-size: 16px;
	margin-left: 2px;
	margin-right: 5px;
}

.checkbox-on {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22%2358A9D7%22%2F%3E%0A%3Cpath%20d%3D%22M6.71429%2012.2852L14%204.9995L12.7143%203.71436L6.71429%209.71378L3.28571%206.2831L2%207.57092L6.71429%2012.2852Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fsvg%3E");
}

.checkbox-off {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20x%3D%220.75%22%20y%3D%220.75%22%20width%3D%2214.5%22%20height%3D%2214.5%22%20fill%3D%22white%22%20stroke%3D%22%2336352F%22%20stroke-width%3D%221.5%22%2F%3E%0A%3C%2Fsvg%3E");
}
	
</style></head><body><article id="f877a0d0-96b8-457e-9417-9cecfd7c49b9" class="page sans"><header><h1 class="page-title">Systems Manager Session Manegerを利用したOSログイン</h1><p class="page-description"></p><table class="properties"><tbody><tr class="property-row property-row-multi_select"><th><span class="icon property-icon"><svg role="graphics-symbol" viewBox="0 0 16 16" style="width:14px;height:14px;display:block;fill:rgba(55, 53, 47, 0.45);flex-shrink:0" class="typesMultipleSelect"><path d="M1.91602 4.83789C2.44238 4.83789 2.87305 4.40723 2.87305 3.87402C2.87305 3.34766 2.44238 2.91699 1.91602 2.91699C1.38281 2.91699 0.952148 3.34766 0.952148 3.87402C0.952148 4.40723 1.38281 4.83789 1.91602 4.83789ZM5.1084 4.52344H14.3984C14.7607 4.52344 15.0479 4.23633 15.0479 3.87402C15.0479 3.51172 14.7607 3.22461 14.3984 3.22461H5.1084C4.74609 3.22461 4.45898 3.51172 4.45898 3.87402C4.45898 4.23633 4.74609 4.52344 5.1084 4.52344ZM1.91602 9.03516C2.44238 9.03516 2.87305 8.60449 2.87305 8.07129C2.87305 7.54492 2.44238 7.11426 1.91602 7.11426C1.38281 7.11426 0.952148 7.54492 0.952148 8.07129C0.952148 8.60449 1.38281 9.03516 1.91602 9.03516ZM5.1084 8.7207H14.3984C14.7607 8.7207 15.0479 8.43359 15.0479 8.07129C15.0479 7.70898 14.7607 7.42188 14.3984 7.42188H5.1084C4.74609 7.42188 4.45898 7.70898 4.45898 8.07129C4.45898 8.43359 4.74609 8.7207 5.1084 8.7207ZM1.91602 13.2324C2.44238 13.2324 2.87305 12.8018 2.87305 12.2686C2.87305 11.7422 2.44238 11.3115 1.91602 11.3115C1.38281 11.3115 0.952148 11.7422 0.952148 12.2686C0.952148 12.8018 1.38281 13.2324 1.91602 13.2324ZM5.1084 12.918H14.3984C14.7607 12.918 15.0479 12.6309 15.0479 12.2686C15.0479 11.9062 14.7607 11.6191 14.3984 11.6191H5.1084C4.74609 11.6191 4.45898 11.9062 4.45898 12.2686C4.45898 12.6309 4.74609 12.918 5.1084 12.918Z"></path></svg></span>タグ</th><td></td></tr></tbody></table></header><div class="page-body"><figure id="a3ab330b-362b-4a99-b661-d248c56ed158" class="image" style="text-align:left"><a href="Systems%20Manager%20Session%20Maneger%E3%82%92%E5%88%A9%E7%94%A8%E3%81%97%E3%81%9FOS%E3%83%AD%E3%82%AF%E3%82%99%E3%82%A4%E3%83%B3%20f877a0d096b8457e94179cecfd7c49b9/AWS-Systems-Manager4x.png"><img style="width:300px" src="Systems%20Manager%20Session%20Maneger%E3%82%92%E5%88%A9%E7%94%A8%E3%81%97%E3%81%9FOS%E3%83%AD%E3%82%AF%E3%82%99%E3%82%A4%E3%83%B3%20f877a0d096b8457e94179cecfd7c49b9/AWS-Systems-Manager4x.png"/></a></figure><h1 id="df865ba9-a9f4-4961-9aa0-64488954daf3" class="">目次</h1><hr id="0e183025-36cb-432f-bd04-047b42eb113f"/><nav id="e1f71bc5-97f1-467a-b05c-6808e6966946" class="block-color-gray table_of_contents"><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#df865ba9-a9f4-4961-9aa0-64488954daf3">目次</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#5599457f-a420-4a17-bd1b-72113c04090d">はじめに</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#46376cf2-9734-406b-a48b-7d96ceef9425">AWS Systems Manager とは</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#5c396875-816d-43d6-88d7-554e8c8e16f2">AWS Systems Managerの利用方法</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#7a3a388e-cc3e-49ab-ab8a-a05af5d8d55b">AWS Systems Manager Session Manger利用のための準備（PublicSubnetの場合）</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#78758a81-8191-464b-8282-5421cf5ce594">AWS Systems Manager Session Manger利用のための準備（PrivateSubnetの場合）</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#8c90b31b-1473-4223-a5f1-779267cb5325">AWS Systems Manager Session Manger利用</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#d0887fd2-43a5-49fc-a81a-5305721e0541">たまにある質問の補足</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#a7201dd2-02d5-4e40-82f7-8476c98ebb5e">Linuxのファイル転送の場合</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#a6440901-4e8a-47cd-9e7a-5c25dab67335">RDP接続の場合</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#fe2ddce8-3e95-4ae3-9e9d-dd0cc795b984">最後に</a></div></nav><h1 id="5599457f-a420-4a17-bd1b-72113c04090d" class="">はじめに</h1><hr id="5fd07e75-b042-42f5-bd73-20c566df4a60"/><p id="3c68d29d-a320-4fed-9b8f-a05fbe87bc03" class="">AWS Systems Manager Session Mangerについて公式ドキュメント見れば分かりますが、</p><p id="9b169dc5-a289-44d3-a254-8e0ea8d02f33" class="">今まで調べてきたものを忘れないようにするために自分の備忘録として記載します。</p><h1 id="46376cf2-9734-406b-a48b-7d96ceef9425" class="">AWS Systems Manager とは</h1><hr id="16217fde-9550-4e9a-91a3-482f0d105399"/><p id="89496539-19b2-449b-be48-c0514fd8bac4" class="">AWSの構成管理ツールのサービスでAWS Systems Managerを利用するために</p><p id="9b8134c6-8aad-4b6c-b551-899ae3c9fe58" class="">SSM AgentをEC2インスタンスへインストールする必要があります。 </p><p id="3440b441-f4e9-450f-b06a-24fdce35b03f" class="">尚、一部のOSには既にデフォルトでインストールされているのでインストールする必要はありません。 </p><ul id="7a7072fa-c9f5-4da5-86fb-ddfc3d3b5be7" class="bulleted-list"><li style="list-style-type:disc"><a href="https://docs.aws.amazon.com/ja_jp/systems-manager/latest/userguide/sysman-manual-agent-install.html">https://docs.aws.amazon.com/ja_jp/systems-manager/latest/userguide/sysman-manual-agent-install.html</a></li></ul><ul id="9fcf02ab-dcc9-4b81-b45b-a2031c19ff8e" class="bulleted-list"><li style="list-style-type:disc"><a href="https://docs.aws.amazon.com/ja_jp/systems-manager/latest/userguide/sysman-install-ssm-win.html">https://docs.aws.amazon.com/ja_jp/systems-manager/latest/userguide/sysman-install-ssm-win.html</a></li></ul><p id="4298bbb6-51ca-4e02-808e-313b3c93ca9e" class="">またオンプレミス環境にもインストールできるようですが、こちらについては機会があるときに試したら再度記載したいと思います。</p><ul id="bdb0978c-d08b-4edd-9dd8-ee1022eb147e" class="bulleted-list"><li style="list-style-type:disc"><a href="https://docs.aws.amazon.com/ja_jp/systems-manager/latest/userguide/systems-manager-managedinstances.html">https://docs.aws.amazon.com/ja_jp/systems-manager/latest/userguide/systems-manager-managedinstances.html</a></li></ul><h1 id="5c396875-816d-43d6-88d7-554e8c8e16f2" class="">AWS Systems Managerの利用方法</h1><hr id="4c6ac711-9f3c-44f6-abfc-7cf819ac735b"/><p id="4f0a452d-e0d5-42ed-9a02-e594ee886750" class="">AWS Systems Managerが使えるようにするためには以下を実施します。</p><ul id="0510df6d-3fbd-407c-8dac-81d8b02e185d" class="bulleted-list"><li style="list-style-type:disc">SSM Agentのインストール </li></ul><ul id="9368c10d-58f4-46a3-b4eb-0a8c7ef0f9a7" class="bulleted-list"><li style="list-style-type:disc">SSM AgentからSSM APIへの経路</li></ul><ul id="8a4e13b0-90c5-402d-bdc0-f9b439c5fd9f" class="bulleted-list"><li style="list-style-type:disc">IAMロールの付与</li></ul><p id="aa3b4fcd-6916-4903-8dd1-4117ab43c450" class="">
</p><p id="ec3c4b64-a9bb-48ef-9abd-033674f5e02e" class="">SSM Agentが導入されていないものについては上記にリンクを貼っているのでそちらを参考にしてください。</p><p id="719ea702-9969-476e-aac4-09d7c25477f9" class="">SSM Agentはインターネット経由もしくはVPCエンドポイント経由でアウトバンドでの経路が必要になります。 </p><p id="5b3cefac-6612-4e5d-abcd-a8414aef6a14" class="">インターネット経由でやる場合にはパブリックサブネット上に配置するかNATゲートウェイを経由します。 </p><p id="1988489a-2e38-4cc3-a2c7-206c681c78a4" class="">VPCエンドポイント経由であればプライベートに配置されていてもアクセスが可能になります。</p><p id="8fad07b4-5376-4dde-8bbc-1af45d96cab1" class="">IAMロール作成してEC2に適用する必要がありIAMポリシーについては、AmazonSSMManagedInstanceCoreを付与する必要があります。</p><p id="29a7ea93-9315-4863-b8dd-c630d71f74c2" class="">
</p><p id="dd7d87ac-47e9-4523-940e-cb180c3ad6f2" class="">AWS Systems Manager Session Mangerとは</p><p id="6ab6d5dd-21b0-4888-bd93-6b96a31b7b3c" class="">Session Mangerを利用することでEC2へのアクセスのためにインバウンドポート解放や踏み台サーバの用意などすることなく、 </p><p id="30c4ad6a-ea43-4ef4-8608-95513cce70e4" class="">ブラウザからShellを操作することができ、かつSSHでアクセスからIAM経由でのアクセスとなり操作履歴も残すことができるようになります。</p><p id="2a12df46-0554-4711-8029-6bd792e5119f" class="">なお利用するにあたりVPCの「DNS ホスト名とDNS 解決は有効」になっていることを確認してください。</p><ul id="cb243177-62f8-45cc-baea-040edab377ff" class="bulleted-list"><li style="list-style-type:disc"><a href="https://docs.aws.amazon.com/ja_jp/systems-manager/latest/userguide/security_iam_service-with-iam.html">https://docs.aws.amazon.com/ja_jp/systems-manager/latest/userguide/security_iam_service-with-iam.html</a></li></ul><h1 id="7a3a388e-cc3e-49ab-ab8a-a05af5d8d55b" class="">AWS Systems Manager Session Manger利用のための準備（PublicSubnetの場合）</h1><hr id="ca5475dc-1de7-4753-aeee-d45c0c19a786"/><p id="996a4ebe-b68c-4115-affe-bd36708b9e86" class="">先ほど述べたように3ステップ踏む必要がありますが、 今回はデフォルトでインストールされているAmazonLinux2を利用し、</p><p id="3e875689-0a2a-4d20-897d-635ee46179c0" class="">パブリックネットワークにおいてます。 またEC2を作成する前に事前にIAMロールを用意しておくほうが良いと思うので</p><p id="f3ccd657-d2d2-44ec-afee-6863634cfe75" class="">IAM画面からロール=&gt;ロール作成へと進み、 以下の画面のように選択して次へ進みます。</p><figure id="a613969b-b70e-4c00-a66b-7180b6f38fbe" class="image" style="text-align:left"><a href="Systems%20Manager%20Session%20Maneger%E3%82%92%E5%88%A9%E7%94%A8%E3%81%97%E3%81%9FOS%E3%83%AD%E3%82%AF%E3%82%99%E3%82%A4%E3%83%B3%20f877a0d096b8457e94179cecfd7c49b9/20220421233838.png"><img style="width:576px" src="Systems%20Manager%20Session%20Maneger%E3%82%92%E5%88%A9%E7%94%A8%E3%81%97%E3%81%9FOS%E3%83%AD%E3%82%AF%E3%82%99%E3%82%A4%E3%83%B3%20f877a0d096b8457e94179cecfd7c49b9/20220421233838.png"/></a></figure><p id="8d798fea-eadf-4b6a-a6de-d145926783be" class="">次に許可ポリシーを選択する画面がでてくるので検索画面にて、</p><p id="5b8f93c0-cdf6-48e9-9d19-cfaeb30a6bc8" class=""> AmazonSSMManagedInstanceCoreと入力してEnterを押すと、</p><p id="db26e013-d3ad-42bf-a43e-b646bda82aec" class="">対象のポリシーが表示されるのでチェックを入れて次へ進みます。</p><figure id="d861cff3-a592-4079-816d-fc1561bc5508" class="image" style="text-align:left"><a href="Systems%20Manager%20Session%20Maneger%E3%82%92%E5%88%A9%E7%94%A8%E3%81%97%E3%81%9FOS%E3%83%AD%E3%82%AF%E3%82%99%E3%82%A4%E3%83%B3%20f877a0d096b8457e94179cecfd7c49b9/20220421234010.png"><img style="width:768px" src="Systems%20Manager%20Session%20Maneger%E3%82%92%E5%88%A9%E7%94%A8%E3%81%97%E3%81%9FOS%E3%83%AD%E3%82%AF%E3%82%99%E3%82%A4%E3%83%B3%20f877a0d096b8457e94179cecfd7c49b9/20220421234010.png"/></a></figure><p id="fd139de6-874a-4554-a761-a469c2ab05f0" class="">最後にロール名と必要に応じてタグを付与してロール作成をします。</p><p id="cc21042b-372e-4552-8216-8012e4d33cb6" class=""> EC2を作成する際には今回作成したIAMロールを選択忘れしないようにロールを適用してください。</p><figure id="ebabc3c2-356d-41f1-998f-fc2114c99469" class="image" style="text-align:left"><a href="Systems%20Manager%20Session%20Maneger%E3%82%92%E5%88%A9%E7%94%A8%E3%81%97%E3%81%9FOS%E3%83%AD%E3%82%AF%E3%82%99%E3%82%A4%E3%83%B3%20f877a0d096b8457e94179cecfd7c49b9/20220421234329.png"><img style="width:336px" src="Systems%20Manager%20Session%20Maneger%E3%82%92%E5%88%A9%E7%94%A8%E3%81%97%E3%81%9FOS%E3%83%AD%E3%82%AF%E3%82%99%E3%82%A4%E3%83%B3%20f877a0d096b8457e94179cecfd7c49b9/20220421234329.png"/></a></figure><p id="c7b3af2f-a4d6-47ba-97a8-5d54f68dfc93" class="">またSessionManger経由でアクセスのみとするのであればセキュリティグループのInboundの解放やキーペアの作成も不要になるので、</p><p id="4b74bf10-4e7b-448e-9528-501ef886bdde" class="">不要な場合は作成しないようにしましょう。</p><p id="b278b206-137e-47b6-9cfe-314f72c4676f" class="">尚、本内容を実施する際に、Outboudを制限かけている場合は、443ポートが外にでられるようにSecurityGroupを設定してください。</p><h1 id="78758a81-8191-464b-8282-5421cf5ce594" class="">AWS Systems Manager Session Manger利用のための準備（PrivateSubnetの場合）</h1><hr id="422b2f9e-05e2-4e5d-928e-11e98cfc4676"/><p id="70035b0b-6d05-4319-9619-0de7ae4fff43" class="">ロール作成からEC2への適用まではPublicSubnetのやり方と同じです。</p><p id="429a7413-6828-46ce-966e-92aedf496843" class="">今回の場合はPublicSubnetにNAT Gatewayがない場合で記載をしています。</p><p id="c1315a7e-241b-4ade-86e8-c510781d84dd" class="">PublicSubnetにNAT Gatewayがある場合にはPublicSubnetと同様のやり方で問題ありません。</p><p id="29a3f497-6189-4ae0-9425-445dc98dc211" class="">PrivateSubnetの場合にはインターネットにでることができないので、SSM Endpointを作る必要があります。</p><p id="8195def5-b8f0-43e3-8fc3-f5a6b30858af" class="">作成するエンドポイントは以下になります。</p><ul id="e0a998be-2433-41da-8e71-94f47b6e0798" class="bulleted-list"><li style="list-style-type:disc">ssmmessages</li></ul><ul id="9bfaa9f2-52bf-4aff-8d26-ed38b9068cda" class="bulleted-list"><li style="list-style-type:disc">ssm</li></ul><ul id="0909ffcc-bb29-46b1-b75f-340aa5254ec1" class="bulleted-list"><li style="list-style-type:disc">ec2messages</li></ul><p id="428f042b-f2e2-4e3e-804b-5a2a25bdfb88" class="">
</p><p id="45c0bb08-f6c8-43bd-ac9f-810233c74a33" class="">VPCエンドポイントを作成する上で気をつけなければならないことは、紐づけるサブネットが多くなった場合にはその分料金がかかるので、</p><p id="76e2a278-5065-4fb5-ad52-bb4367e7a876" class="">エンドポイントを冗長化するかシングルにするかはお金と要相談してください。</p><p id="1998f111-897e-4c57-8cbe-6fb6fa60c5d7" class="">エンドポイントの作成場所はVPC画面メニューのエンドポイントから作成できます。</p><p id="5fc4febc-15e9-4eb6-a826-9ab9a25cda8a" class="">VPCエンドポイントを作成したらエンドポイントインターフェースに対して、443ポートのInbound許可のSecurityGroupを作成して適用します。</p><h1 id="8c90b31b-1473-4223-a5f1-779267cb5325" class="">AWS Systems Manager Session Manger利用</h1><hr id="8ca77822-6e9a-4894-8d19-8e768c8bcc69"/><p id="23d2cf4a-cb5e-43f1-91b9-5318c4315218" class="">AWS Systems Managerから左メニューのセッションマネージャーをクリックすると以下の画面が表示されるので、 </p><p id="e6ecfcb6-150d-477b-a8bb-feeeb6836ce0" class="">セッションの開始をクリックします。</p><figure id="ded15660-7b1a-4454-a513-136782a70729" class="image" style="text-align:left"><a href="Systems%20Manager%20Session%20Maneger%E3%82%92%E5%88%A9%E7%94%A8%E3%81%97%E3%81%9FOS%E3%83%AD%E3%82%AF%E3%82%99%E3%82%A4%E3%83%B3%20f877a0d096b8457e94179cecfd7c49b9/20220421234449.png"><img style="width:768px" src="Systems%20Manager%20Session%20Maneger%E3%82%92%E5%88%A9%E7%94%A8%E3%81%97%E3%81%9FOS%E3%83%AD%E3%82%AF%E3%82%99%E3%82%A4%E3%83%B3%20f877a0d096b8457e94179cecfd7c49b9/20220421234449.png"/></a></figure><p id="bb63704a-7da2-482a-833b-179f84c05a90" class="">接続するターゲットインスタンスの一覧が表示されるので、接続する対象を選択しセッションの開始をクリックすると、</p><p id="d0749ee9-775b-44c5-8e73-1452569a75ca" class="">ブラウザShellが起動します。LinuxならShell、WindowsならPowerShellになります。</p><figure id="040cbd4f-61d3-470a-8332-6c3385ae4f2a" class="image" style="text-align:left"><a href="Systems%20Manager%20Session%20Maneger%E3%82%92%E5%88%A9%E7%94%A8%E3%81%97%E3%81%9FOS%E3%83%AD%E3%82%AF%E3%82%99%E3%82%A4%E3%83%B3%20f877a0d096b8457e94179cecfd7c49b9/20220421234643.png"><img style="width:768px" src="Systems%20Manager%20Session%20Maneger%E3%82%92%E5%88%A9%E7%94%A8%E3%81%97%E3%81%9FOS%E3%83%AD%E3%82%AF%E3%82%99%E3%82%A4%E3%83%B3%20f877a0d096b8457e94179cecfd7c49b9/20220421234643.png"/></a></figure><figure id="02adba1d-cc94-4c17-87d3-e529349c2b4e" class="image" style="text-align:left"><a href="Systems%20Manager%20Session%20Maneger%E3%82%92%E5%88%A9%E7%94%A8%E3%81%97%E3%81%9FOS%E3%83%AD%E3%82%AF%E3%82%99%E3%82%A4%E3%83%B3%20f877a0d096b8457e94179cecfd7c49b9/20220421235045.png"><img style="width:768px" src="Systems%20Manager%20Session%20Maneger%E3%82%92%E5%88%A9%E7%94%A8%E3%81%97%E3%81%9FOS%E3%83%AD%E3%82%AF%E3%82%99%E3%82%A4%E3%83%B3%20f877a0d096b8457e94179cecfd7c49b9/20220421235045.png"/></a></figure><p id="2862e3d7-afdd-4310-8e3f-f707f1d8081b" class="">また事前に実行ログなどをCloudWatchLogやS3にも保存しておくことができます。</p><figure id="35bca198-eb92-479f-b7a3-f1a9169791f8" class="image" style="text-align:left"><a href="Systems%20Manager%20Session%20Maneger%E3%82%92%E5%88%A9%E7%94%A8%E3%81%97%E3%81%9FOS%E3%83%AD%E3%82%AF%E3%82%99%E3%82%A4%E3%83%B3%20f877a0d096b8457e94179cecfd7c49b9/20220421235243.png"><img style="width:768px" src="Systems%20Manager%20Session%20Maneger%E3%82%92%E5%88%A9%E7%94%A8%E3%81%97%E3%81%9FOS%E3%83%AD%E3%82%AF%E3%82%99%E3%82%A4%E3%83%B3%20f877a0d096b8457e94179cecfd7c49b9/20220421235243.png"/></a></figure><h1 id="d0887fd2-43a5-49fc-a81a-5305721e0541" class="">たまにある質問の補足</h1><hr id="98ee4a81-af2c-4b3f-a563-144348d77725"/><p id="9af18011-35cd-436a-b7ab-c9f4afb4b3ac" class="">ブラウザ経由でアクセスできるのは便利なんだけどLinuxのファイル転送やRDP接続してGUI操作したい時はどうすればいいの？ </p><p id="27200028-29d1-4b77-a853-b03e6108907c" class="">とたまに聞かれることがありますので補足します。</p><h1 id="a7201dd2-02d5-4e40-82f7-8476c98ebb5e" class="">Linuxのファイル転送の場合</h1><hr id="665e4ea5-afee-461f-b5a5-db9f4f0f5a2c"/><p id="f2fa6bff-e8cd-4e6b-9c37-910b1adc8cd3" class="">接続元にAWS CLIとSession ManagerのPluginをインストールします。 </p><p id="f717cb81-d1fb-4287-ae02-9a2d45b4fc43" class="">※ここからはMACで実施しています。 </p><ul id="d84e79c3-25c6-4a6b-9f21-2b205cc7728f" class="bulleted-list"><li style="list-style-type:disc"><a href="https://docs.aws.amazon.com/systems-manager/latest/userguide/session-manager-working-with-install-plugin.html">https://docs.aws.amazon.com/systems-manager/latest/userguide/session-manager-working-with-install-plugin.html</a></li></ul><p id="83301c86-55a8-4ea6-b1b6-d9a156eb53d1" class="">その後SSHするための設定を.ssh/configに追記します。</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="f6cda79d-0280-4b11-be93-eaf08703120c" class="code"><code class="language-Shell" style="white-space:pre-wrap;word-break:break-all"># SSH over Session Manager
host i-* mi-*
    ProxyCommand sh -c &quot;aws ssm start-session --target %h --document-name AWS-StartSSHSession --parameters &#x27;portNumber=%p&#x27;&quot;</code></pre><p id="61eacb12-9bae-4d92-bee9-ed0ffae61261" class="">IAMに必要なポリシーは以下を参考にしました。 </p><ul id="e919e7fa-f6cc-490d-a308-94b9c3142413" class="bulleted-list"><li style="list-style-type:disc"><a href="https://docs.aws.amazon.com/ja_jp/systems-manager/latest/userguide/session-manager-getting-started-enable-ssh-connections.html">https://docs.aws.amazon.com/ja_jp/systems-manager/latest/userguide/session-manager-getting-started-enable-ssh-connections.html</a></li></ul><p id="01779f82-c83e-4c56-8f8f-68cae72f6426" class=""><code>&quot;ssm:SessionDocumentAccessCheck&quot;:&quot;true&quot;</code> を指定することで、<code>Resource</code> で指定したすべての条件が存在しないとエラーになります。</p><p id="8e3565a7-ff85-49ce-a456-62f5da5acd1e" class="">つまり、Document の AWS-StartSSHSessionやAWS-StartPortForwardingSessionを指定して</p><p id="a4bdcf6a-1d9e-46e9-8b77-72555dafb665" class=""> <code>start-session</code> コマンドを実行しないとダメということになり、特定の Document のみが実行できる環境が出来上がります。</p><p id="f97399f2-dafa-4c6b-983b-64e5fb81e4b6" class="">document/***は SystemsMangerのドキュメントで管理されており、AWS-StartSSHSessionとAWS-StartPortForwardingSessionはAmazon所有となっています。</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="28806df1-c6ce-49d2-9ee6-118a38f6fd33" class="code"><code class="language-Shell">{
    &quot;Version&quot;: &quot;2012-10-17&quot;,
    &quot;Statement&quot;: [
        {
            &quot;Effect&quot;: &quot;Allow&quot;,
            &quot;Action&quot;: [
                &quot;ssm:StartSession&quot;,
                &quot;ssm:SendCommand&quot;
            ],
            &quot;Resource&quot;: [
                &quot;arn:aws:ec2:ap-northeast-1:AWSアカウントID:instance/*&quot;,
                &quot;arn:aws:ssm:ap-northeast-1::document/AWS-StartPortForwardingSession&quot;,
                &quot;arn:aws:ssm:ap-northeast-1:AWSアカウントID:document/SSM-SessionManagerRunShell&quot;,
                &quot;arn:aws:ssm:ap-northeast-1::document/AWS-StartSSHSession&quot;
            ],
            &quot;Condition&quot;: {
                &quot;BoolIfExists&quot;: {
                    &quot;ssm:SessionDocumentAccessCheck&quot;: &quot;ture&quot;
                }
            }
        },
        {
            &quot;Effect&quot;: &quot;Allow&quot;,
            &quot;Action&quot;: [
                &quot;ssm:DescribeSessions&quot;,
                &quot;ssm:GetConnectionStatus&quot;,
                &quot;ssm:DescribeInstanceInformation&quot;,
                &quot;ssm:DescribeInstanceProperties&quot;,
                &quot;ec2:DescribeInstances&quot;,
                &quot;ssm-guiconnect:StartConnection&quot;,
                &quot;ssm-guiconnect:GetConnection&quot;,
                &quot;ssm-guiconnect:CancelConnection&quot;
            ],
            &quot;Resource&quot;: &quot;*&quot;
        },
        {
            &quot;Effect&quot;: &quot;Allow&quot;,
            &quot;Action&quot;: [
                &quot;ssm:TerminateSession&quot;,
                &quot;ssm:ResumeSession&quot;
            ],
            &quot;Resource&quot;: [
                &quot;arn:aws:ssm:ap-northeast-1:AWSアカウントID:session/${aws:username}-*&quot;
            ]
        }
    ]
}</code></pre><p id="de5aeb6c-a451-417d-8cfb-2b27533576d0" class="">接続元を絞るためにGIP制限もかけました。</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="6894c32b-f843-4825-92a0-e4b0fcfab01f" class="code"><code class="language-Shell" style="white-space:pre-wrap;word-break:break-all">{
    &quot;Version&quot;: &quot;2012-10-17&quot;,
    &quot;Statement&quot;: [
        {
            &quot;Condition&quot;: {
                &quot;NotIpAddress&quot;: {
                    &quot;aws:SourceIp&quot;: [
                        &quot;GlobalIPAddress/32&quot;,
                        &quot;GlobalIPAddress/32&quot;
                    ]
                }
            },
            &quot;Action&quot;: &quot;*&quot;,
            &quot;Resource&quot;: &quot;*&quot;,
            &quot;Effect&quot;: &quot;Deny&quot;
        }
    ]
}</code></pre><p id="068e61cd-08a1-4cab-ae95-724f8e9ce7a7" class="">作成したポリシーをアタッチするためにIAMロールを作成し、IAMユーザを作成してロールをアタッチします。</p><p id="173a9b6b-e8d3-4567-a64a-67e6924d0a7d" class="">アクセスキーとシークレットキーを発行して、 aws configureを実行して認証情報をクライアント側に登録しておきます。</p><p id="414adc64-94f6-4c38-ad11-f2618a0bd217" class="">最後にクライアント側からSSH接続すると接続できるので、同じ要領でSCPコマンドでファイル転送することが可能になります。</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="c8dbe975-79ff-47b6-bcf6-427d57a0ba80" class="code"><code class="language-Bash" style="white-space:pre-wrap;word-break:break-all">% ssh ec2-user@インスタンスID -i ./鍵ファイルの名前
Last login: Thu Apr 21 15:33:00 2022 from localhost

       __|  __|_  )
       _|  (     /   Amazon Linux 2 AMI
      ___|\___|___|

https://aws.amazon.com/amazon-linux-2/
16 package(s) needed for security, out of 25 available
Run &quot;sudo yum update&quot; to apply all updates.
[ec2-user@xxx-xxx-xxx-xxx ~]$

% scp -i &lt;秘密鍵&gt; &lt;ローカルファイル&gt; ec2-user@&lt;インスタンスID&gt;:＜転送先のディレクトリ&gt;</code></pre><h1 id="a6440901-4e8a-47cd-9e7a-5c25dab67335" class="">RDP接続の場合</h1><hr id="1ad876db-2830-458c-bcde-984ef5135e95"/><p id="1ee3e60b-a49e-4e58-aa4c-91d81e01bd01" class="">接続元にAWS CLIとSession ManagerのPluginをインストールします。 </p><p id="d6337f04-8e05-49f0-bcd1-4417a6260b1e" class="">IAMに必要なポリシーはLinuxのファイル転送の場合と同じポリシーを利用します。</p><p id="e45fb4d7-8815-46db-b6c4-fce2c833579c" class="">先ほどは記載していませんがssm:TerminateSession では自分自身のsessionだけを対象とするため、${aws:username}-* とし、</p><p id="de5523b5-6c5c-465b-90db-290f318ed7d0" class="">IPでの制限をかけたい場合には絞りたいIPアドレスにIPアドレスを記載することで制限をつけることもできます。</p><p id="d4028ed5-75c0-45b2-9c07-9f6ef1ad5083" class="">アクセスキーとシークレットキーを発行して、 aws configureを実行して認証情報をクライアント側に登録しておきます。</p><p id="4dbf5747-62a9-46c1-88c6-fb9e4fa95c3e" class="">
</p><p id="994c3a17-670e-4450-8817-85b02280e303" class="">最後にクライアント側からAWS CLIを使って接続することでRDP接続が可能になります。</p><p id="30305e24-d022-4868-8c32-fe37b8109450" class="">尚、RDPで接続している間は、以下コマンドを実行したウィンドウは閉じないようにしてください。</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="2cce6b6d-7462-4a6c-b726-c83e32df7248" class="code"><code class="language-Shell" style="white-space:pre-wrap;word-break:break-all">aws ssm start-session --target EC2のインスタンスID --document-name AWS-StartPortForwardingSession --parameters &quot;portNumber=3389, localPortNumber=13389&quot;</code></pre><p id="ef15c6e0-c2ae-483d-bca2-8641ed89c5c1" class="">ここではローカルポート番号を13389にしているので、RDP接続する際にはlocalhost:13389で接続します。</p><h1 id="fe2ddce8-3e95-4ae3-9e9d-dd0cc795b984" class="">最後に</h1><hr id="b5c0f5ef-bd9d-4256-b639-8479ff701ce2"/><p id="1aee1b2f-eb4f-4597-a775-19120dc790a6" class="">SessionManagerは料金は無料で利用できるサービスになります。 ここまでできれば脱SSHができそうな気がしますし、</p><p id="218396e7-0637-4c85-98c8-96107104fcbb" class="">踏み台サーバが不要になるので無駄なリソースコストが発生しなくていいですよね。 （エンドポイントの料金はかかりますが）</p><p id="291b1b82-6a00-4051-a307-2da994efca8c" class="">慣れの問題とは思いますが、こちらの利用をすることをお勧めします。</p><p id="94963303-275f-4d2a-8496-3965cbb97e00" class="">
</p><p id="4103ae7b-3356-4835-9a58-04bb4c9873a7" class="">
</p><p id="e32cd63f-8077-4eb1-8823-f814fa12415d" class="">
</p></div></article><span class="sans" style="font-size:14px;padding-top:2em"></span></body></html>