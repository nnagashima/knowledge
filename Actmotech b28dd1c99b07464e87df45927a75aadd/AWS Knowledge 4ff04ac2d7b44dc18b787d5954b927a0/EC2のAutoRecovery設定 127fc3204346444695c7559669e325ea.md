# EC2のAutoRecovery設定

![580280edfa1e5bb58a50f6a27ea18aa2.png](EC2%E3%81%AEAutoRecovery%E8%A8%AD%E5%AE%9A%20127fc3204346444695c7559669e325ea/580280edfa1e5bb58a50f6a27ea18aa2.png)

# 目次

---

# AutoRecoveryとは

---

CloudWatchのモニタリングサービスを利用して物理的な障害が発生した際に、

EC2インスタンス単位での自動復旧ができるようにする仕組みになります。

EC2作成時に自動復旧の設定がありますが、この設定だとアラートになった際に通知がこないので、

通知が必要な場合には手動でアラームを作成する必要があります。

# AutoRecoveryのアラーム作成

---

EC2インスタンスを右クリックして「CloudWatchアラームの管理」をクリックしてアラーム作成をクリックします。

- 「アラーム作成」を選択します。
- アラーム通知に通知したいSNSトピックを選択します。
- アラームアクションに「復旧」をクリックします。
- サンプルのグループか基準を「最小」にします。
- サンプリングするデータのタイプを「ステータスチェックの失敗：システム」にします。

上記内容を入力したら作成をクリックします。

![FireShot Capture 997 - CloudWatch アラームの管理 - EC2 - ap-northeast-1_ - ap-northeast-1.console.aws.amazon.com.png](EC2%E3%81%AEAutoRecovery%E8%A8%AD%E5%AE%9A%20127fc3204346444695c7559669e325ea/FireShot_Capture_997_-_CloudWatch_%25E3%2582%25A2%25E3%2583%25A9%25E3%2583%25BC%25E3%2583%25A0%25E3%2581%25AE%25E7%25AE%25A1%25E7%2590%2586_-_EC2_-_ap-northeast-1__-_ap-northeast-1.console.aws.amazon.com.png)

![Untitled](EC2%E3%81%AEAutoRecovery%E8%A8%AD%E5%AE%9A%20127fc3204346444695c7559669e325ea/Untitled.png)

CloudWatchの画面に移動して作成したアラームが存在していることを確認します。

![FireShot Capture 1000 - StatusCheckFailed_System - アラーム - CloudWatch - ap-northeast-1_ - ap-northeast-1.console.aws.amazon.com.png](EC2%E3%81%AEAutoRecovery%E8%A8%AD%E5%AE%9A%20127fc3204346444695c7559669e325ea/FireShot_Capture_1000_-_StatusCheckFailed_System_-_%25E3%2582%25A2%25E3%2583%25A9%25E3%2583%25BC%25E3%2583%25A0_-_CloudWatch_-_ap-northeast-1__-_ap-northeast-1.console.aws.amazon.com.png)

アクションタブにてインスタンス復旧のアクションと、アラーム状態の時のアクションが存在していることを確認します。

このままだと復旧時の時にはアラーム通知が実施されないので、右上のアクション▼から「編集」をクリックします。

![FireShot Capture 1001 - StatusCheckFailed_System - アラーム - CloudWatch - ap-northeast-1_ - ap-northeast-1.console.aws.amazon.com.png](EC2%E3%81%AEAutoRecovery%E8%A8%AD%E5%AE%9A%20127fc3204346444695c7559669e325ea/FireShot_Capture_1001_-_StatusCheckFailed_System_-_%25E3%2582%25A2%25E3%2583%25A9%25E3%2583%25BC%25E3%2583%25A0_-_CloudWatch_-_ap-northeast-1__-_ap-northeast-1.console.aws.amazon.com.png)

アクションの設定の画面で「通知の追加」をクリックし、復旧アクションを追加してアラームを更新します。

![FireShot Capture 1002 - CloudWatch - ap-northeast-1 - ap-northeast-1.console.aws.amazon.com.png](EC2%E3%81%AEAutoRecovery%E8%A8%AD%E5%AE%9A%20127fc3204346444695c7559669e325ea/FireShot_Capture_1002_-_CloudWatch_-_ap-northeast-1_-_ap-northeast-1.console.aws.amazon.com.png)

# AutoRecoveryの注意点

---

AutoRecoveryを設定するにあたっての条件は以下になります。

```jsx
1. 対応しているインスタンスタイプは以下です。
A1、C3、C4、C5、C5a、C5n、C6g、Inf1、 M3、M4、M5、M5a、M5n、M5zn、M6g、 P3、R3、R4、R5、R5a、R5b、R5n、R6g、 T2、T3、T3a、X1、X1eのいずれか

2. EBSボリュームのみ（インスタンスストアがない）

3. defaultまたはdedicatedインスタンステナンシーで起動していること
```