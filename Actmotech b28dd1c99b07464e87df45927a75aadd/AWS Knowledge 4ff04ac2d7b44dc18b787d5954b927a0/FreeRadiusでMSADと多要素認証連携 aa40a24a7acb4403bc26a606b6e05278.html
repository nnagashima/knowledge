<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>FreeRadiusでMSADと多要素認証連携</title><style>
/* cspell:disable-file */
/* webkit printing magic: print all background colors */
html {
	-webkit-print-color-adjust: exact;
}
* {
	box-sizing: border-box;
	-webkit-print-color-adjust: exact;
}

html,
body {
	margin: 0;
	padding: 0;
}
@media only screen {
	body {
		margin: 2em auto;
		max-width: 900px;
		color: rgb(55, 53, 47);
	}
}

body {
	line-height: 1.5;
	white-space: pre-wrap;
}

a,
a.visited {
	color: inherit;
	text-decoration: underline;
}

.pdf-relative-link-path {
	font-size: 80%;
	color: #444;
}

h1,
h2,
h3 {
	letter-spacing: -0.01em;
	line-height: 1.2;
	font-weight: 600;
	margin-bottom: 0;
}

.page-title {
	font-size: 2.5rem;
	font-weight: 700;
	margin-top: 0;
	margin-bottom: 0.75em;
}

h1 {
	font-size: 1.875rem;
	margin-top: 1.875rem;
}

h2 {
	font-size: 1.5rem;
	margin-top: 1.5rem;
}

h3 {
	font-size: 1.25rem;
	margin-top: 1.25rem;
}

.source {
	border: 1px solid #ddd;
	border-radius: 3px;
	padding: 1.5em;
	word-break: break-all;
}

.callout {
	border-radius: 3px;
	padding: 1rem;
}

figure {
	margin: 1.25em 0;
	page-break-inside: avoid;
}

figcaption {
	opacity: 0.5;
	font-size: 85%;
	margin-top: 0.5em;
}

mark {
	background-color: transparent;
}

.indented {
	padding-left: 1.5em;
}

hr {
	background: transparent;
	display: block;
	width: 100%;
	height: 1px;
	visibility: visible;
	border: none;
	border-bottom: 1px solid rgba(55, 53, 47, 0.09);
}

img {
	max-width: 100%;
}

@media only print {
	img {
		max-height: 100vh;
		object-fit: contain;
	}
}

@page {
	margin: 1in;
}

.collection-content {
	font-size: 0.875rem;
}

.column-list {
	display: flex;
	justify-content: space-between;
}

.column {
	padding: 0 1em;
}

.column:first-child {
	padding-left: 0;
}

.column:last-child {
	padding-right: 0;
}

.table_of_contents-item {
	display: block;
	font-size: 0.875rem;
	line-height: 1.3;
	padding: 0.125rem;
}

.table_of_contents-indent-1 {
	margin-left: 1.5rem;
}

.table_of_contents-indent-2 {
	margin-left: 3rem;
}

.table_of_contents-indent-3 {
	margin-left: 4.5rem;
}

.table_of_contents-link {
	text-decoration: none;
	opacity: 0.7;
	border-bottom: 1px solid rgba(55, 53, 47, 0.18);
}

table,
th,
td {
	border: 1px solid rgba(55, 53, 47, 0.09);
	border-collapse: collapse;
}

table {
	border-left: none;
	border-right: none;
}

th,
td {
	font-weight: normal;
	padding: 0.25em 0.5em;
	line-height: 1.5;
	min-height: 1.5em;
	text-align: left;
}

th {
	color: rgba(55, 53, 47, 0.6);
}

ol,
ul {
	margin: 0;
	margin-block-start: 0.6em;
	margin-block-end: 0.6em;
}

li > ol:first-child,
li > ul:first-child {
	margin-block-start: 0.6em;
}

ul > li {
	list-style: disc;
}

ul.to-do-list {
	padding-inline-start: 0;
}

ul.to-do-list > li {
	list-style: none;
}

.to-do-children-checked {
	text-decoration: line-through;
	opacity: 0.375;
}

ul.toggle > li {
	list-style: none;
}

ul {
	padding-inline-start: 1.7em;
}

ul > li {
	padding-left: 0.1em;
}

ol {
	padding-inline-start: 1.6em;
}

ol > li {
	padding-left: 0.2em;
}

.mono ol {
	padding-inline-start: 2em;
}

.mono ol > li {
	text-indent: -0.4em;
}

.toggle {
	padding-inline-start: 0em;
	list-style-type: none;
}

/* Indent toggle children */
.toggle > li > details {
	padding-left: 1.7em;
}

.toggle > li > details > summary {
	margin-left: -1.1em;
}

.selected-value {
	display: inline-block;
	padding: 0 0.5em;
	background: rgba(206, 205, 202, 0.5);
	border-radius: 3px;
	margin-right: 0.5em;
	margin-top: 0.3em;
	margin-bottom: 0.3em;
	white-space: nowrap;
}

.collection-title {
	display: inline-block;
	margin-right: 1em;
}

.page-description {
    margin-bottom: 2em;
}

.simple-table {
	margin-top: 1em;
	font-size: 0.875rem;
	empty-cells: show;
}
.simple-table td {
	height: 29px;
	min-width: 120px;
}

.simple-table th {
	height: 29px;
	min-width: 120px;
}

.simple-table-header-color {
	background: rgb(247, 246, 243);
	color: black;
}
.simple-table-header {
	font-weight: 500;
}

time {
	opacity: 0.5;
}

.icon {
	display: inline-block;
	max-width: 1.2em;
	max-height: 1.2em;
	text-decoration: none;
	vertical-align: text-bottom;
	margin-right: 0.5em;
}

img.icon {
	border-radius: 3px;
}

.user-icon {
	width: 1.5em;
	height: 1.5em;
	border-radius: 100%;
	margin-right: 0.5rem;
}

.user-icon-inner {
	font-size: 0.8em;
}

.text-icon {
	border: 1px solid #000;
	text-align: center;
}

.page-cover-image {
	display: block;
	object-fit: cover;
	width: 100%;
	max-height: 30vh;
}

.page-header-icon {
	font-size: 3rem;
	margin-bottom: 1rem;
}

.page-header-icon-with-cover {
	margin-top: -0.72em;
	margin-left: 0.07em;
}

.page-header-icon img {
	border-radius: 3px;
}

.link-to-page {
	margin: 1em 0;
	padding: 0;
	border: none;
	font-weight: 500;
}

p > .user {
	opacity: 0.5;
}

td > .user,
td > time {
	white-space: nowrap;
}

input[type="checkbox"] {
	transform: scale(1.5);
	margin-right: 0.6em;
	vertical-align: middle;
}

p {
	margin-top: 0.5em;
	margin-bottom: 0.5em;
}

.image {
	border: none;
	margin: 1.5em 0;
	padding: 0;
	border-radius: 0;
	text-align: center;
}

.code,
code {
	background: rgba(135, 131, 120, 0.15);
	border-radius: 3px;
	padding: 0.2em 0.4em;
	border-radius: 3px;
	font-size: 85%;
	tab-size: 2;
}

code {
	color: #eb5757;
}

.code {
	padding: 1.5em 1em;
}

.code-wrap {
	white-space: pre-wrap;
	word-break: break-all;
}

.code > code {
	background: none;
	padding: 0;
	font-size: 100%;
	color: inherit;
}

blockquote {
	font-size: 1.25em;
	margin: 1em 0;
	padding-left: 1em;
	border-left: 3px solid rgb(55, 53, 47);
}

.bookmark {
	text-decoration: none;
	max-height: 8em;
	padding: 0;
	display: flex;
	width: 100%;
	align-items: stretch;
}

.bookmark-title {
	font-size: 0.85em;
	overflow: hidden;
	text-overflow: ellipsis;
	height: 1.75em;
	white-space: nowrap;
}

.bookmark-text {
	display: flex;
	flex-direction: column;
}

.bookmark-info {
	flex: 4 1 180px;
	padding: 12px 14px 14px;
	display: flex;
	flex-direction: column;
	justify-content: space-between;
}

.bookmark-image {
	width: 33%;
	flex: 1 1 180px;
	display: block;
	position: relative;
	object-fit: cover;
	border-radius: 1px;
}

.bookmark-description {
	color: rgba(55, 53, 47, 0.6);
	font-size: 0.75em;
	overflow: hidden;
	max-height: 4.5em;
	word-break: break-word;
}

.bookmark-href {
	font-size: 0.75em;
	margin-top: 0.25em;
}

.sans { font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; }
.code { font-family: "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace; }
.serif { font-family: Lyon-Text, Georgia, ui-serif, serif; }
.mono { font-family: iawriter-mono, Nitti, Menlo, Courier, monospace; }
.pdf .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK JP'; }
.pdf:lang(zh-CN) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC'; }
.pdf:lang(zh-TW) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK TC'; }
.pdf:lang(ko-KR) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK KR'; }
.pdf .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.pdf .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK JP'; }
.pdf:lang(zh-CN) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK SC'; }
.pdf:lang(zh-TW) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK TC'; }
.pdf:lang(ko-KR) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK KR'; }
.pdf .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.highlight-default {
	color: rgba(55, 53, 47, 1);
}
.highlight-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.highlight-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.highlight-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.highlight-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.highlight-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.highlight-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.highlight-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.highlight-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.highlight-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.highlight-default_background {
	color: rgba(55, 53, 47, 1);
}
.highlight-gray_background {
	background: rgba(241, 241, 239, 1);
}
.highlight-brown_background {
	background: rgba(244, 238, 238, 1);
}
.highlight-orange_background {
	background: rgba(251, 236, 221, 1);
}
.highlight-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.highlight-teal_background {
	background: rgba(237, 243, 236, 1);
}
.highlight-blue_background {
	background: rgba(231, 243, 248, 1);
}
.highlight-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.highlight-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.highlight-red_background {
	background: rgba(253, 235, 236, 1);
}
.block-color-default {
	color: inherit;
	fill: inherit;
}
.block-color-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.block-color-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.block-color-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.block-color-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.block-color-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.block-color-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.block-color-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.block-color-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.block-color-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.block-color-default_background {
	color: inherit;
	fill: inherit;
}
.block-color-gray_background {
	background: rgba(241, 241, 239, 1);
}
.block-color-brown_background {
	background: rgba(244, 238, 238, 1);
}
.block-color-orange_background {
	background: rgba(251, 236, 221, 1);
}
.block-color-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.block-color-teal_background {
	background: rgba(237, 243, 236, 1);
}
.block-color-blue_background {
	background: rgba(231, 243, 248, 1);
}
.block-color-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.block-color-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.block-color-red_background {
	background: rgba(253, 235, 236, 1);
}
.select-value-color-uiBlue { background-color: rgba(35, 131, 226, .07); }
.select-value-color-pink { background-color: rgba(245, 224, 233, 1); }
.select-value-color-purple { background-color: rgba(232, 222, 238, 1); }
.select-value-color-green { background-color: rgba(219, 237, 219, 1); }
.select-value-color-gray { background-color: rgba(227, 226, 224, 1); }
.select-value-color-transparentGray { background-color: rgba(227, 226, 224, 0); }
.select-value-color-translucentGray { background-color: rgba(0, 0, 0, 0.06); }
.select-value-color-orange { background-color: rgba(250, 222, 201, 1); }
.select-value-color-brown { background-color: rgba(238, 224, 218, 1); }
.select-value-color-red { background-color: rgba(255, 226, 221, 1); }
.select-value-color-yellow { background-color: rgba(253, 236, 200, 1); }
.select-value-color-blue { background-color: rgba(211, 229, 239, 1); }
.select-value-color-pageGlass { background-color: undefined; }
.select-value-color-washGlass { background-color: undefined; }

.checkbox {
	display: inline-flex;
	vertical-align: text-bottom;
	width: 16;
	height: 16;
	background-size: 16px;
	margin-left: 2px;
	margin-right: 5px;
}

.checkbox-on {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22%2358A9D7%22%2F%3E%0A%3Cpath%20d%3D%22M6.71429%2012.2852L14%204.9995L12.7143%203.71436L6.71429%209.71378L3.28571%206.2831L2%207.57092L6.71429%2012.2852Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fsvg%3E");
}

.checkbox-off {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20x%3D%220.75%22%20y%3D%220.75%22%20width%3D%2214.5%22%20height%3D%2214.5%22%20fill%3D%22white%22%20stroke%3D%22%2336352F%22%20stroke-width%3D%221.5%22%2F%3E%0A%3C%2Fsvg%3E");
}
	
</style></head><body><article id="aa40a24a-7acb-4403-bc26-a606b6e05278" class="page sans"><header><h1 class="page-title"><strong>FreeRadius</strong>でMSADと多要素認証連携</h1><p class="page-description"></p><table class="properties"><tbody><tr class="property-row property-row-multi_select"><th><span class="icon property-icon"><svg role="graphics-symbol" viewBox="0 0 16 16" style="width:14px;height:14px;display:block;fill:rgba(55, 53, 47, 0.45);flex-shrink:0" class="typesMultipleSelect"><path d="M1.91602 4.83789C2.44238 4.83789 2.87305 4.40723 2.87305 3.87402C2.87305 3.34766 2.44238 2.91699 1.91602 2.91699C1.38281 2.91699 0.952148 3.34766 0.952148 3.87402C0.952148 4.40723 1.38281 4.83789 1.91602 4.83789ZM5.1084 4.52344H14.3984C14.7607 4.52344 15.0479 4.23633 15.0479 3.87402C15.0479 3.51172 14.7607 3.22461 14.3984 3.22461H5.1084C4.74609 3.22461 4.45898 3.51172 4.45898 3.87402C4.45898 4.23633 4.74609 4.52344 5.1084 4.52344ZM1.91602 9.03516C2.44238 9.03516 2.87305 8.60449 2.87305 8.07129C2.87305 7.54492 2.44238 7.11426 1.91602 7.11426C1.38281 7.11426 0.952148 7.54492 0.952148 8.07129C0.952148 8.60449 1.38281 9.03516 1.91602 9.03516ZM5.1084 8.7207H14.3984C14.7607 8.7207 15.0479 8.43359 15.0479 8.07129C15.0479 7.70898 14.7607 7.42188 14.3984 7.42188H5.1084C4.74609 7.42188 4.45898 7.70898 4.45898 8.07129C4.45898 8.43359 4.74609 8.7207 5.1084 8.7207ZM1.91602 13.2324C2.44238 13.2324 2.87305 12.8018 2.87305 12.2686C2.87305 11.7422 2.44238 11.3115 1.91602 11.3115C1.38281 11.3115 0.952148 11.7422 0.952148 12.2686C0.952148 12.8018 1.38281 13.2324 1.91602 13.2324ZM5.1084 12.918H14.3984C14.7607 12.918 15.0479 12.6309 15.0479 12.2686C15.0479 11.9062 14.7607 11.6191 14.3984 11.6191H5.1084C4.74609 11.6191 4.45898 11.9062 4.45898 12.2686C4.45898 12.6309 4.74609 12.918 5.1084 12.918Z"></path></svg></span>タグ</th><td></td></tr></tbody></table></header><div class="page-body"><figure id="2342c0ac-a513-4e02-92b5-f118aaeb3579" class="image" style="text-align:left"><a href="FreeRadius%E3%81%A6%E3%82%99MSAD%E3%81%A8%E5%A4%9A%E8%A6%81%E7%B4%A0%E8%AA%8D%E8%A8%BC%E9%80%A3%E6%90%BA%20aa40a24a7acb4403bc26a606b6e05278/580280edfa1e5bb58a50f6a27ea18aa2.png"><img style="width:144px" src="FreeRadius%E3%81%A6%E3%82%99MSAD%E3%81%A8%E5%A4%9A%E8%A6%81%E7%B4%A0%E8%AA%8D%E8%A8%BC%E9%80%A3%E6%90%BA%20aa40a24a7acb4403bc26a606b6e05278/580280edfa1e5bb58a50f6a27ea18aa2.png"/></a></figure><h1 id="61839035-b718-4b10-9fad-f186ebe463f1" class="">目次</h1><hr id="2bc0d93f-e0e0-4211-b354-e7def8ef9280"/><nav id="0b712b5c-c54c-4813-9c98-fcbbce95438c" class="block-color-gray table_of_contents"><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#61839035-b718-4b10-9fad-f186ebe463f1">目次</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#9e520c4a-df81-48de-8869-8e06910d58a5">はじめに</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#0d2eeb0e-d485-4391-b56a-ea56b2460d4b">FreeRadiusのパッケージのインストール</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#49369e58-71bf-4393-ade8-c1fc5c9c408a">FreeRadiusの起動テスト</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#c47f7d56-698d-4477-af62-bedcb6059a41">Google Authenticatorをインストール</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#fe97ee29-87a3-48f5-84b1-ba144a4d072f">ホスト名の設定</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#e2833edd-c56b-4f29-9cfb-88ed69d936b6">FreeRadiusの設定</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#8daba29b-50a7-4fe7-8e1b-19785a49f42d"><strong>RadiusがGoogoleAuthenticatorを利用するようにする</strong></a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#9cd14184-58b6-45e9-b30a-633d55659f59">Radiusのクライアント設定</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#dc4f0ea4-a0dc-48ca-89d2-33a4f0d5ca8a">PAMモジュールの有効化</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#febe74a5-22f8-4fe3-a0fb-0408aa000de2">FreeRadiusの再起動</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#a75fdcae-66e5-4546-80c2-865e40c63238">WorkSpacesにログインするユーザーを追加</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#288184fb-715d-4df1-852e-818060cde125">MSADにて多要素認証を有効化</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#a1bccfe0-cecc-40a7-9e36-e60958ce8c02">WorkSpacesへのログイン</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#6f1597e9-93d1-4f85-8f0e-7e8c369ba0d9">ここまでを振り返って</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#de9b2302-79dd-4da9-8dd6-69e62f45f908">ADとFreeRadiusでユーザー管理が別になるを解消</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#93651dee-df3d-47aa-b50d-f772704405ba">シングル構成を冗長構成にしたいを解消</a></div></nav><h1 id="9e520c4a-df81-48de-8869-8e06910d58a5" class="">はじめに</h1><hr id="869fc982-7da8-4fe8-83d5-311f28d021ea"/><p id="9c9ac509-8453-48cf-b3d2-ef01fd263323" class="">MSADだとWorkSpacesやClientVPNと接続する際にAD認証のみとなります。</p><p id="7b70a07b-3a1b-4627-a417-67e9ecbe1da3" class="">AD認証以外ですと</p><ul id="eb999ac8-5edb-4813-bf27-d6ac2b46dfa8" class="bulleted-list"><li style="list-style-type:disc">WorkSpacesの場合はデバイス証明書による認証</li></ul><ul id="d0bfe587-77fb-490b-bea2-7963487142f0" class="bulleted-list"><li style="list-style-type:disc">ClientVPNの場合はクライアント証明書で認証</li></ul><p id="b6bba71d-6311-4ba2-9ab7-197926b3a899" class="">をすることできます。</p><p id="bfc64894-7ad9-4dbe-9bb4-daea4ed24d34" class="">それ以外には多要素認証をサポートしております。</p><p id="24faa00c-7e35-4944-8711-a3427fc7ecd4" class="">Passlogicを利用したやり方は以下リンクで記載していますが、今回はFreeRadiusを利用したやり方を記載していきます。</p><figure id="3046605e-2916-4d96-8e9b-91fce1f8e3a2" class="link-to-page"><a href="https://www.notion.so/PassLogic-AWS-WorkSpaces-3046605e29164d968e9b91fce1f8e3a2?pvs=21">PassLogicを利用したAWS WorkSpacesの多要素認証化</a></figure><h1 id="0d2eeb0e-d485-4391-b56a-ea56b2460d4b" class="">FreeRadiusのパッケージのインストール</h1><hr id="cab31227-3f5f-4a0a-8dd2-bcaf028fea0f"/><p id="fcb77910-8ee3-47f8-8ef5-04f69038c3ad" class="">OSはAmazonLinux2023を利用しています。</p><p id="45af1ac0-db59-4ed5-9015-4f613817c8f8" class="">EPELレポジトリをまずは追加したいところですが、AmazonLinux2023にはEPELリポジトリはサポートされていません。</p><p id="2f4759f0-2ebb-48a3-be43-769b683e63e6" class="">なのでソースからRPMを作るというかなりイレギュラーなことを最初からします。</p><p id="c90fd7b9-98bc-4bee-bea5-7b90ba48ae04" class="">※RHELを選んでいればこんなことにはならない</p><p id="15ef646d-396b-485d-91fb-7f3c87689566" class="">freeradiusのソースRPMからRPMを作成するためにソースのダウンロードとRPMビルトするためのパッケージを追加します。</p><p id="0ed55007-4b3d-4616-9059-0addc531a385" class="">また最後にQRコードを表示させるためのパッケージも追加します。</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="e168cddc-c7f5-4ff8-9412-6ec0bd088dd2" class="code"><code class="language-JavaScript" style="white-space:pre-wrap;word-break:break-all"># wget https://ftp.riken.jp/Linux/fedora/releases/40/Everything/source/tree/Packages/f/freeradius-3.2.3-4.fc40.src.rpm
# yum install rpm-build qrencode-libs</code></pre><p id="9f1a3ad4-b1e7-4e18-990d-7b50c7de872d" class="">freeradiusのRPMを作成します。</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1739e9fc-87ac-42f5-8245-a36ca19350b3" class="code"><code class="language-JavaScript" style="white-space:pre-wrap;word-break:break-all"># rpmbuild --rebuild freeradius-3.2.3-4.fc40.src.rpm 
Installing freeradius-3.2.3-4.fc40.src.rpm
warning: freeradius-3.2.3-4.fc40.src.rpm: Header V4 RSA/SHA256 Signature, key ID a15b79cc: NOKEY
setting SOURCE_DATE_EPOCH=1706054400
error: Failed build dependencies:
        autoconf is needed by freeradius-3.2.3-4.amzn2023.x86_64
        chrpath is needed by freeradius-3.2.3-4.amzn2023.x86_64
        gcc is needed by freeradius-3.2.3-4.amzn2023.x86_64
        gdbm-devel is needed by freeradius-3.2.3-4.amzn2023.x86_64
        json-c-devel is needed by freeradius-3.2.3-4.amzn2023.x86_64
        krb5-devel is needed by freeradius-3.2.3-4.amzn2023.x86_64
        libcurl-devel is needed by freeradius-3.2.3-4.amzn2023.x86_64
        libpcap-devel is needed by freeradius-3.2.3-4.amzn2023.x86_64
        libpq-devel is needed by freeradius-3.2.3-4.amzn2023.x86_64
        libtalloc-devel is needed by freeradius-3.2.3-4.amzn2023.x86_64
        libyubikey-devel is needed by freeradius-3.2.3-4.amzn2023.x86_64
        make is needed by freeradius-3.2.3-4.amzn2023.x86_64
        mariadb-connector-c-devel is needed by freeradius-3.2.3-4.amzn2023.x86_64
        net-snmp-devel is needed by freeradius-3.2.3-4.amzn2023.x86_64
        net-snmp-utils is needed by freeradius-3.2.3-4.amzn2023.x86_64
        openldap-devel is needed by freeradius-3.2.3-4.amzn2023.x86_64
        openssl-devel is needed by freeradius-3.2.3-4.amzn2023.x86_64
        pam-devel is needed by freeradius-3.2.3-4.amzn2023.x86_64
        perl(ExtUtils::Embed) is needed by freeradius-3.2.3-4.amzn2023.x86_64
        perl-devel is needed by freeradius-3.2.3-4.amzn2023.x86_64
        perl-generators is needed by freeradius-3.2.3-4.amzn2023.x86_64
        python3-devel is needed by freeradius-3.2.3-4.amzn2023.x86_64
        readline-devel is needed by freeradius-3.2.3-4.amzn2023.x86_64
        sqlite-devel is needed by freeradius-3.2.3-4.amzn2023.x86_64
        unixODBC-devel is needed by freeradius-3.2.3-4.amzn2023.x86_64
        ykclient-devel is needed by freeradius-3.2.3-4.amzn2023.x86_64
        zlib-devel is needed by freeradius-3.2.3-4.amzn2023.x86_64</code></pre><p id="17143143-9936-40e3-9873-8e17005648a7" class="">失敗しました。前提となるパッケージが足りないのエラー内容からインストールしていきます。</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="c2a4e2da-86f5-45a8-97e5-82b6a15d43e6" class="code"><code class="language-JavaScript" style="white-space:pre-wrap;word-break:break-all"># yum install -y autoconf chrpath gcc gdbm-devel json-c-devel krb5-devel libcurl-devel libpcap-devel libpq-devel libtalloc-devel libyubikey-devel make mariadb-connector-c-devel net-snmp-devel net-snmp-utils openldap-devel openssl-devel pam-devel perl-ExtUtils-Embed perl-devel perl-generators python3-devel readline-devel sqlite-devel unixODBC-devel ykclient-devel zlib-devel 
No match for argument: libyubikey-devel
No match for argument: ykclient-devel
Error: Unable to find a match: libyubikey-devel ykclient-devel</code></pre><p id="ec383705-22c2-4ee7-b2e4-389fe06dfad5" class="">libyubikey-develとykclient-develはyumにないみたいなので、それ以外をインストールしてソースRPMをダウンロードしてビルドしてインストールします。</p><p id="aaaf423c-371c-4457-a67f-22b5597008a6" class="">▪️libyubikey-devel</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="4d4f05b8-7c40-4bc0-b322-5b1111a36ac2" class="code"><code class="language-JavaScript" style="white-space:pre-wrap;word-break:break-all"># wget https://ftp.riken.jp/Linux/fedora/releases/40/Everything/source/tree/Packages/l/libyubikey-1.13-22.fc40.src.rpm
# rpmbuild --rebuild libyubikey-1.13-22.fc40.src.rpm
# rpm -ivh ./rpmbuild/RPMS/x86_64/libyubikey-1.13-22.amzn2023.x86_64.rpm 
# rpm -ivh ./rpmbuild/RPMS/x86_64/libyubikey-devel-1.13-22.amzn2023.x86_64.rpm </code></pre><p id="9562022e-5b65-4560-8ace-5b4856bf3e3e" class="">▪️ykclient-devel（help2manパッケージが必要でした）</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1b79af6b-b93a-4866-b970-07b0b1d6cb18" class="code"><code class="language-JavaScript" style="white-space:pre-wrap;word-break:break-all"># wget https://ftp.riken.jp/Linux/fedora/releases/40/Everything/source/tree/Packages/y/ykclient-2.15-18.fc40.src.rpm
# rpmbuild --rebuild ./ykclient-2.15-18.fc40.src.rpm 
Installing ./ykclient-2.15-18.fc40.src.rpm
warning: ./ykclient-2.15-18.fc40.src.rpm: Header V4 RSA/SHA256 Signature, key ID a15b79cc: NOKEY
setting SOURCE_DATE_EPOCH=1706313600
error: Failed build dependencies:
        help2man is needed by ykclient-2.15-18.amzn2023.x86_64
        
# yum instal -y help2man
# rpmbuild --rebuild ./ykclient-2.15-18.fc40.src.rpm 
# rpm -ivh ./rpmbuild/RPMS/x86_64/ykclient-2.15-18.amzn2023.x86_64.rpm
# rpm -ivh ./rpmbuild/RPMS/x86_64/ykclient-devel-2.15-18.amzn2023.x86_64.rpm </code></pre><p id="826cbf91-f79f-4312-a7e2-6f34701dbbd7" class="">今度こそfreeradiusのRPMを作成してインストールしますが、perl-DBI、perl-GDBM_File、perl-Net-IPが必要でした。。。</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="2eed336f-d089-4e46-b271-4c29bef88305" class="code"><code class="language-JavaScript" style="white-space:pre-wrap;word-break:break-all"># rpmbuild --rebuild freeradius-3.2.3-4.fc40.src.rpm 
# rpm -ivh ./rpmbuild/RPMS/x86_64/freeradius-3.2.3-4.amzn2023.x86_64.rpm
# rpm -ivh ./rpmbuild/RPMS/x86_64/freeradius-utils-3.2.3-4.amzn2023.x86_64.rpm 
error: Failed dependencies:
        perl(DBI) is needed by freeradius-utils-3.2.3-4.amzn2023.x86_64
        perl(GDBM_File) is needed by freeradius-utils-3.2.3-4.amzn2023.x86_64
        perl(Net::IP) is needed by freeradius-utils-3.2.3-4.amzn2023.x86_64</code></pre><p id="8cff3c54-4c2f-4b9f-bd15-ac379da18322" class="">perl-DBI、perl-GDBM_File、perl-Net-IPをyumでインストールしましたがperl-Net-IPだけ失敗したので、ソースからビルドしてインストールします。</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="21940f24-9cde-45b5-882b-b2bd14e8fb6d" class="code"><code class="language-JavaScript" style="white-space:pre-wrap;word-break:break-all"># yum install -y perl-DBI perl-GDBM_File perl-Net-IP
No match for argument: perl-Net-IP
Error: Unable to find a match: perl-Net-IP

# wget https://ftp.riken.jp/Linux/fedora/releases/40/Everything/source/tree/Packages/p/perl-Net-IP-1.26-33.fc40.src.rpm
# rpmbuild --rebuild perl-Net-IP-1.26-33.fc40.src.rpm
# rpm -ivh ./rpmbuild/RPMS/noarch/perl-Net-IP-1.26-33.amzn2023.noarch.rpm</code></pre><p id="db60f7fc-dab1-485f-8ef2-7549f4a6933d" class="">今度こそfreeradiusをインストールしてインストールできました。ふぅ。</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1c8d5b20-f644-4010-b23a-05aa6c1a09fb" class="code"><code class="language-JavaScript" style="white-space:pre-wrap;word-break:break-all"># rpm -ivh ./rpmbuild/RPMS/x86_64/freeradius-3.2.3-4.amzn2023.x86_64.rpm
# rpm -ivh ./rpmbuild/RPMS/x86_64/freeradius-utils-3.2.3-4.amzn2023.x86_64.rpm </code></pre><h1 id="49369e58-71bf-4393-ade8-c1fc5c9c408a" class="">FreeRadiusの起動テスト</h1><hr id="4bee5a3d-2b8e-4874-bc6b-d21f83ffc4ba"/><p id="ae4cdcdd-e103-44ed-a5c6-96f0c92e01cc" class="">rlm_eap_tls というEAP-TLS 認証をするための証明書を作成します。</p><p id="3b522a38-f18a-4f8d-9f03-d6888c630888" class="">※マニュアルは/etc/raddb/certs/README.mdに記載されています。</p><p id="2a8a4d94-9d2a-4c34-a0ef-54f219251485" class="">証明書の期限が60日となっているので100年に修正します。</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="fd364c36-9d08-4704-8418-c4d786adaa1d" class="code"><code class="language-JavaScript" style="white-space:pre-wrap;word-break:break-all"> # cd /etc/raddb/certs
 # vi ca.cnf
 # vi client.cnf
 # vi server.cnf
default_days            = 36500
default_crl_days        = 36500</code></pre><p id="e741e905-866b-4efe-a2cb-65a5319a4759" class="">証明書を作成します。</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="299164cb-171b-4559-9b44-1e06dda80ca4" class="code"><code class="language-JavaScript" style="white-space:pre-wrap;word-break:break-all"># /etc/raddb/certs/bootstrap</code></pre><p id="281f99c2-cfb2-4d15-99b6-77ba8216d4be" class="">FreeRadiusを起動します。</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="515a1c82-38db-446f-a867-df3df0c311af" class="code"><code class="language-JavaScript" style="white-space:pre-wrap;word-break:break-all"># systemctl start radiusd
# systemctl status radiusd
● radiusd.service - FreeRADIUS high performance RADIUS server.
     Loaded: loaded (/usr/lib/systemd/system/radiusd.service; disabled; preset: disabled)
     Active: active (running) since Wed 2024-05-15 22:06:54 JST; 4s ago
    Process: 84381 ExecStartPre=/bin/chown -R radiusd.radiusd /var/run/radiusd (code=exited, status=0/SUCCESS)
    Process: 84382 ExecStartPre=/usr/sbin/radiusd -C (code=exited, status=0/SUCCESS)
    Process: 84384 ExecStart=/usr/sbin/radiusd -d /etc/raddb (code=exited, status=0/SUCCESS)
   Main PID: 84386 (radiusd)
      Tasks: 6 (limit: 2251)
     Memory: 41.0M
        CPU: 93ms
     CGroup: /system.slice/radiusd.service
             └─84386 /usr/sbin/radiusd -d /etc/raddb

May 15 22:06:54 ip-10-1-13-83.ap-northeast-1.compute.internal systemd[1]: Starting radiusd.service - FreeRADIUS high performance RADIUS server....
May 15 22:06:54 ip-10-1-13-83.ap-northeast-1.compute.internal systemd[1]: Started radiusd.service - FreeRADIUS high performance RADIUS server..</code></pre><h1 id="c47f7d56-698d-4477-af62-bedcb6059a41" class="">Google Authenticatorをインストール</h1><hr id="6a29f3e8-90f7-483f-88b8-e5df4fedfff6"/><p id="3f2a635f-b745-4ecd-8f65-bf70c7945f06" class="">google-authenticatorをインストールした後にFreeRadiusを再起動します。</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="64d8e4e4-b9c4-4b6f-b13d-d6eed48374e3" class="code"><code class="language-JavaScript" style="white-space:pre-wrap;word-break:break-all"># yum install -y google-authenticator
# systemctl restart radiusd</code></pre><h1 id="fe97ee29-87a3-48f5-84b1-ba144a4d072f" class="">ホスト名の設定</h1><hr id="002e012b-9faa-4800-9a56-d92e9c12eaff"/><p id="99152142-e63a-4164-b444-5858e131925b" class="">ホスト名はGoogleAuthenticatorに登録した登録名に利用されるのでホスト名を任意の名前に変更します。</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="aafc1ac1-ff42-4473-b019-a324e99e55c0" class="code"><code class="language-JavaScript" style="white-space:pre-wrap;word-break:break-all"># hostnamectl set-hostname radius.ドメイン名</code></pre><p id="293a261f-c6e1-41a1-a94c-80f5a604ae9b" class="">hostsファイルにも記載します。</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="b2871dd4-7d84-42d0-a14e-afb834c83112" class="code"><code class="language-JavaScript" style="white-space:pre-wrap;word-break:break-all"># vi /etc/hosts
IPアドレス  radius.ドメイン名</code></pre><h1 id="e2833edd-c56b-4f29-9cfb-88ed69d936b6" class="">FreeRadiusの設定</h1><hr id="6a453a82-cfd9-45f6-b7aa-386694ddbb34"/><p id="1ef38a82-764a-479a-9708-70867381b16b" class="">radiusd.confを修正します。</p><p id="ac4991a8-1672-40a7-80ae-85636d667c5e" class="">まずrootユーザーで起動させる必要があるため、以下のように変更します。</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="6eb85895-70e2-4ac4-a2ca-8236846ca85f" class="code"><code class="language-JavaScript" style="white-space:pre-wrap;word-break:break-all"># vi /etc/raddb/radiusd.conf 
512         user = root
513         group = root</code></pre><p id="27d649b0-2748-482f-95b3-b289adf4abcf" class="">続いてradius-enabledのユーザーがradius認証を経由するように設定します。</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="4703ff1b-a101-442e-beca-2af5c04c26bf" class="code"><code class="language-JavaScript" style="white-space:pre-wrap;word-break:break-all"># vi /etc/raddb/users
DEFAULT    Group != &quot;radius-enabled&quot;, Auth-Type := Reject,Reply-Message = &quot;Your account has been disabled.&quot;
DEFAULT    Auth-Type := PAM</code></pre><p id="7891132e-cad8-4205-8522-62d7b0db39ff" class="">最後にdegaultファイルでradius認証の際に利用するpamを有効化します。</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="c5fd08d4-62b5-451b-93b0-b202effd6b07" class="code"><code class="language-JavaScript" style="white-space:pre-wrap;word-break:break-all"># vi /etc/raddb/sites-available/default
564         #  Pluggable Authentication Modules.
565         pam</code></pre><h1 id="8daba29b-50a7-4fe7-8e1b-19785a49f42d" class=""><strong>RadiusがGoogoleAuthenticatorを利用するようにする</strong></h1><hr id="a9781998-cd84-4f25-93eb-9ca6a1a3654a"/><p id="ab3e2807-f036-4d0a-894f-84c8db9ec990" class="">GoogoleAuthenticatorが使われるように設定します。</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="c130d76c-904b-4fc1-b6a6-53ad8f2e2a1b" class="code"><code class="language-JavaScript" style="white-space:pre-wrap;word-break:break-all"># vi /etc/pam.d/radiusd
#%PAM-1.0
#auth       include     password-auth
#account    required    pam_nologin.so
#account    include     password-auth
#password   include     password-auth
#session    include     password-auth
auth requisite pam_google_authenticator.so
account required pam_permit.so
session required pam_permit.so</code></pre><h1 id="9cd14184-58b6-45e9-b30a-633d55659f59" class="">Radiusのクライアント設定</h1><hr id="54c27aed-0e6d-4992-b3fc-d70378c05953"/><p id="75a7f157-31d3-4c6c-8e28-169517ed5a1e" class="">workspacesやMicrosoft ADが所属するVPCからのアクセスを許可します。</p><p id="a9698dcc-4cdd-42f9-bd24-584d5cf10d6f" class="">ipaddrはAWS VPC CIDRを記載、secretはDirectory Serviceに入れる設定になります。</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="32db215f-b3ec-4d26-bd0b-21390394da3e" class="code"><code class="language-JavaScript" style="white-space:pre-wrap;word-break:break-all"># vi /etc/raddb/clients.conf
client vpc {
        ipaddr = 10.1.0.0/16
        secret = jat2gcVXLFPKEZt 
}</code></pre><h1 id="dc4f0ea4-a0dc-48ca-89d2-33a4f0d5ca8a" class="">PAMモジュールの有効化</h1><hr id="513b5b72-171e-46b4-9c5f-7a01752fbec6"/><p id="e1e07d19-39c9-454a-9d66-4d93607dcc8a" class=""> PAMモジュールのリンクを登録します。</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="63390a36-fb36-4e7b-85eb-f28d143bb93e" class="code"><code class="language-JavaScript" style="white-space:pre-wrap;word-break:break-all"># ln -s /etc/raddb/mods-available/pam /etc/raddb/mods-enabled/pam</code></pre><h1 id="febe74a5-22f8-4fe3-a0fb-0408aa000de2" class="">FreeRadiusの再起動</h1><hr id="9ce3856c-e6ea-45a0-8600-e1f41a178f88"/><p id="99e9ed36-a7d6-4982-afbd-ba9f1df300d1" class="">FreeRadiusを再起動と自動起動を有効化します。</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="aa3feba2-f289-4d56-824e-2e1b2023efe0" class="code"><code class="language-JavaScript" style="white-space:pre-wrap;word-break:break-all"># systemctl restart radiusd
# systemctl enable radiusd</code></pre><h1 id="a75fdcae-66e5-4546-80c2-865e40c63238" class="">WorkSpacesにログインするユーザーを追加</h1><hr id="8176cbc1-dda4-41ad-91b6-3b6739fd780c"/><p id="aacffd2a-1b8e-4fb6-99f2-2cc08502c0fd" class="">ADでnnagashimaというユーザーを作成しているので、Radiusに登録しま。</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="369ce3ef-b90f-409f-9419-be51ec3c31d6" class="code"><code class="language-JavaScript" style="white-space:pre-wrap;word-break:break-all"># groupadd radius-enabled
# useradd -g radius-enabled nnagashima
# sudo -u nnagashima /usr/bin/google-authenticator
対話式表示されますが、基本yで進んでください。
QRコードが表示されるのでスマホでGoogle Authenticatorアプリを起動してスキャンします。</code></pre><h1 id="288184fb-715d-4df1-852e-818060cde125" class="">MSADにて多要素認証を有効化</h1><hr id="ad56ac5b-f00b-48bf-9f9f-e0a0ada03ea7"/><p id="6428e2ec-09b7-461d-ae6e-0955b5dcf040" class="">対象のディレクトリIDに移動して、多要素認証から有効にして以下の図のように設定します。</p><p id="e556d498-e563-4e81-901c-423f8180dde6" class="">DirectoryServiceのセキュリティグループのアウトバウンドを開放していない場合は忘れずに開放してください。</p><p id="ffc23517-bd28-4797-937b-3421d77ff2a1" class="">シークレットコードはRadiusのクライアント設定で設定したsecretの内容を記載します。</p><figure id="b70f4f3b-690a-4e0b-ad3c-724c27f57e5f" class="image" style="text-align:left"><a href="FreeRadius%E3%81%A6%E3%82%99MSAD%E3%81%A8%E5%A4%9A%E8%A6%81%E7%B4%A0%E8%AA%8D%E8%A8%BC%E9%80%A3%E6%90%BA%20aa40a24a7acb4403bc26a606b6e05278/Untitled.png"><img style="width:624px" src="FreeRadius%E3%81%A6%E3%82%99MSAD%E3%81%A8%E5%A4%9A%E8%A6%81%E7%B4%A0%E8%AA%8D%E8%A8%BC%E9%80%A3%E6%90%BA%20aa40a24a7acb4403bc26a606b6e05278/Untitled.png"/></a></figure><figure id="73d57d16-5f1f-4028-8f42-192cf8afa621" class="image" style="text-align:left"><a href="FreeRadius%E3%81%A6%E3%82%99MSAD%E3%81%A8%E5%A4%9A%E8%A6%81%E7%B4%A0%E8%AA%8D%E8%A8%BC%E9%80%A3%E6%90%BA%20aa40a24a7acb4403bc26a606b6e05278/Untitled%201.png"><img style="width:639.9132080078125px" src="FreeRadius%E3%81%A6%E3%82%99MSAD%E3%81%A8%E5%A4%9A%E8%A6%81%E7%B4%A0%E8%AA%8D%E8%A8%BC%E9%80%A3%E6%90%BA%20aa40a24a7acb4403bc26a606b6e05278/Untitled%201.png"/></a></figure><h1 id="a1bccfe0-cecc-40a7-9e36-e60958ce8c02" class="">WorkSpacesへのログイン</h1><hr id="07b77822-ef95-47a1-be76-b79791775afd"/><p id="3a56df28-9d46-4548-b243-febe283575cd" class="">AD認証に加えて、MFAコードを入力する欄が出ているのでGoogleAuthenticatorを起動して入力して、</p><p id="480867a8-67a7-4129-937d-159c2b15d31a" class="">WorkSpaceへログインができればOKです。（ADアカウント名@ドメイン名）</p><h1 id="6f1597e9-93d1-4f85-8f0e-7e8c369ba0d9" class="">ここまでを振り返って</h1><hr id="0f5f3407-66fa-4e79-9c5a-99a26f55c735"/><ul id="fa2a908a-54e0-4efd-bbcb-c99d8ec56e96" class="bulleted-list"><li style="list-style-type:disc">AmazonLinux2023で作るにはちとめんどくさいですね。</li></ul><ul id="165bc998-ae7e-4dc6-9044-22887a04b8de" class="bulleted-list"><li style="list-style-type:disc">複数ドメイン管理ができないのが辛いですね。（有償ソフトウェアとかが選択肢？）</li></ul><ul id="a942cdec-51d2-4f4b-9213-b066102a801a" class="bulleted-list"><li style="list-style-type:disc">ADとFreeRadiusでユーザー管理が別になるので忘れそうですね。</li></ul><ul id="4f980ec7-4e90-4ea5-ba6b-d8f2f46d6e18" class="bulleted-list"><li style="list-style-type:disc">シングル構成を冗長構成にしたいですね。</li></ul><h1 id="de9b2302-79dd-4da9-8dd6-69e62f45f908" class="">ADとFreeRadiusでユーザー管理が別になるを解消</h1><hr id="e65201ec-5f3d-460f-b001-6be6336a106d"/><p id="af85d823-c6bd-4908-a7e0-a2a27328fb1a" class="">AmazonLinux2023をADドメインへ参加させるためにDNSの向き先をMSADにします。</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="59b6eb4c-bba8-438b-8261-76bb1051c314" class="code"><code class="language-JavaScript" style="white-space:pre-wrap;word-break:break-all"># vi /etc/systemd/resolved.conf
DNS=MSADのIPアドレス1 MSADのIPアドレス2
# systemctl restart systemd-resolved.service</code></pre><p id="a6d80635-cd96-4b13-bb2d-f78ed5abc6e6" class="">AD参加に必要なパッケージを追加してドメイン参加します。</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="3f97d644-b382-4c84-8030-d1bdc1bbea79" class="code"><code class="language-JavaScript" style="white-space:pre-wrap;word-break:break-all"># yum install -y sssd realmd krb5-workstation
# yum install -y oddjob oddjob-mkhomedir sssd adcli
# realm join -U Admin@ドメイン名(大文字) ドメイン名(大文字) --verbose
* Successfully enrolled machine in realm</code></pre><p id="40ac6d08-6a2d-440d-aa7d-6ed14e116bad" class="">ADに結合されたことを確認</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="7fb071d6-19be-49d5-b0de-8402aaf78b32" class="code"><code class="language-JavaScript" style="white-space:pre-wrap;word-break:break-all"># id nnagashima@aws-actmotech.local
uid=644201146(nnagashima@aws-actmotech.local) gid=644200513(domain users@aws-actmotech.local) groups=644200513(domain users@aws-actmotech.local),644201139(aws delegated add workstations to domain users@aws-actmotech.local)</code></pre><p id="1db17eba-f875-486b-81fc-f36cdd9e8543" class="">ADユーザーのQRコード発行</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="3227f84a-22b1-45d6-a89a-1352c86f7b61" class="code"><code class="language-JavaScript" style="white-space:pre-wrap;word-break:break-all"># sudo -u nnagashima@aws-actmotech.local /usr/bin/google-authenticator</code></pre><p id="57e83ddf-59a5-4f63-b9bd-a154be2acad0" class="">/home配下にnnagashima@aws-actmotech.localがいることを確認</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="90f10d6a-a5c1-4611-9c48-5f9e21c0503e" class="code"><code class="language-JavaScript" style="white-space:pre-wrap;word-break:break-all"># ls -la /home/nnagashima@aws-actmotech.local</code></pre><p id="1595993b-f3d1-4943-ad78-709fe3ed5a36" class="">WorkSpacesへのログインできれば完了です。</p><p id="d77068c7-de3f-4d9c-bdde-ceca4317a748" class="">これでユーザー作成は省略することができ、QRコード発行のみで処理可能です。</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="7124e7ae-c9ce-4ec4-9cae-e1bb48b2a3f2" class="code"><code class="language-JavaScript" style="white-space:pre-wrap;word-break:break-all">WorkSpacesログイン時のユーザー名はドメイン名付きで入力することを忘れないようにしてください。</code></pre><h1 id="93651dee-df3d-47aa-b50d-f772704405ba" class="">シングル構成を冗長構成にしたいを解消</h1><hr id="70a3dbbe-c0ec-451d-9531-b395b8168384"/><p id="f900ddc6-e7b8-474c-9d82-95c584c188b8" class="">EC2にEFSをマウントします。(/mnt配下とします。)</p><p id="9c5a8b04-bdeb-41cf-aeb0-120b09a135d8" class="">GoogleAuthenticatorの出力先を変更します。</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="2d067006-3fd5-4022-8716-64d53d6819d9" class="code"><code class="language-JavaScript" style="white-space:pre-wrap;word-break:break-all"># vi /etc/pam.d/radiusd
auth requisite pam_google_authenticator.so secret=/mnt/home/%u/.google_authenticator
account required pam_permit.so
session required pam_permit.so</code></pre><p id="730a9b85-b88b-42e2-8877-e458f236f4b9" class="">sssd.confファイルを修正します。</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="e9450f8b-43d5-478a-bcc3-a379c41d85ad" class="code"><code class="language-JavaScript" style="white-space:pre-wrap;word-break:break-all"># vi /etc/sssd/sssd.conf
#fallback_homedir = /home/%u@%d
fallback_homedir = /mnt/home/%u@%d</code></pre><p id="5923fd50-a5fc-434d-a4cd-8b8155876e86" class="">sssdサービスを再起動します。</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="6eafcf60-8b39-44e2-943d-494c99c28532" class="code"><code class="language-JavaScript" style="white-space:pre-wrap;word-break:break-all"># systemctl restart sssd</code></pre><p id="71c1a534-d2b5-45a5-a2f1-78cab3923105" class="">これを2台目のFreeRadiusを作成するには、EFSをマウントすることで完了となります。</p></div></article><span class="sans" style="font-size:14px;padding-top:2em"></span></body></html>