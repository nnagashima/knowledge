<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>RockyLinux9+Zabbix6+Postgresql14のインストール</title><style>
/* cspell:disable-file */
/* webkit printing magic: print all background colors */
html {
	-webkit-print-color-adjust: exact;
}
* {
	box-sizing: border-box;
	-webkit-print-color-adjust: exact;
}

html,
body {
	margin: 0;
	padding: 0;
}
@media only screen {
	body {
		margin: 2em auto;
		max-width: 900px;
		color: rgb(55, 53, 47);
	}
}

body {
	line-height: 1.5;
	white-space: pre-wrap;
}

a,
a.visited {
	color: inherit;
	text-decoration: underline;
}

.pdf-relative-link-path {
	font-size: 80%;
	color: #444;
}

h1,
h2,
h3 {
	letter-spacing: -0.01em;
	line-height: 1.2;
	font-weight: 600;
	margin-bottom: 0;
}

.page-title {
	font-size: 2.5rem;
	font-weight: 700;
	margin-top: 0;
	margin-bottom: 0.75em;
}

h1 {
	font-size: 1.875rem;
	margin-top: 1.875rem;
}

h2 {
	font-size: 1.5rem;
	margin-top: 1.5rem;
}

h3 {
	font-size: 1.25rem;
	margin-top: 1.25rem;
}

.source {
	border: 1px solid #ddd;
	border-radius: 3px;
	padding: 1.5em;
	word-break: break-all;
}

.callout {
	border-radius: 3px;
	padding: 1rem;
}

figure {
	margin: 1.25em 0;
	page-break-inside: avoid;
}

figcaption {
	opacity: 0.5;
	font-size: 85%;
	margin-top: 0.5em;
}

mark {
	background-color: transparent;
}

.indented {
	padding-left: 1.5em;
}

hr {
	background: transparent;
	display: block;
	width: 100%;
	height: 1px;
	visibility: visible;
	border: none;
	border-bottom: 1px solid rgba(55, 53, 47, 0.09);
}

img {
	max-width: 100%;
}

@media only print {
	img {
		max-height: 100vh;
		object-fit: contain;
	}
}

@page {
	margin: 1in;
}

.collection-content {
	font-size: 0.875rem;
}

.column-list {
	display: flex;
	justify-content: space-between;
}

.column {
	padding: 0 1em;
}

.column:first-child {
	padding-left: 0;
}

.column:last-child {
	padding-right: 0;
}

.table_of_contents-item {
	display: block;
	font-size: 0.875rem;
	line-height: 1.3;
	padding: 0.125rem;
}

.table_of_contents-indent-1 {
	margin-left: 1.5rem;
}

.table_of_contents-indent-2 {
	margin-left: 3rem;
}

.table_of_contents-indent-3 {
	margin-left: 4.5rem;
}

.table_of_contents-link {
	text-decoration: none;
	opacity: 0.7;
	border-bottom: 1px solid rgba(55, 53, 47, 0.18);
}

table,
th,
td {
	border: 1px solid rgba(55, 53, 47, 0.09);
	border-collapse: collapse;
}

table {
	border-left: none;
	border-right: none;
}

th,
td {
	font-weight: normal;
	padding: 0.25em 0.5em;
	line-height: 1.5;
	min-height: 1.5em;
	text-align: left;
}

th {
	color: rgba(55, 53, 47, 0.6);
}

ol,
ul {
	margin: 0;
	margin-block-start: 0.6em;
	margin-block-end: 0.6em;
}

li > ol:first-child,
li > ul:first-child {
	margin-block-start: 0.6em;
}

ul > li {
	list-style: disc;
}

ul.to-do-list {
	padding-inline-start: 0;
}

ul.to-do-list > li {
	list-style: none;
}

.to-do-children-checked {
	text-decoration: line-through;
	opacity: 0.375;
}

ul.toggle > li {
	list-style: none;
}

ul {
	padding-inline-start: 1.7em;
}

ul > li {
	padding-left: 0.1em;
}

ol {
	padding-inline-start: 1.6em;
}

ol > li {
	padding-left: 0.2em;
}

.mono ol {
	padding-inline-start: 2em;
}

.mono ol > li {
	text-indent: -0.4em;
}

.toggle {
	padding-inline-start: 0em;
	list-style-type: none;
}

/* Indent toggle children */
.toggle > li > details {
	padding-left: 1.7em;
}

.toggle > li > details > summary {
	margin-left: -1.1em;
}

.selected-value {
	display: inline-block;
	padding: 0 0.5em;
	background: rgba(206, 205, 202, 0.5);
	border-radius: 3px;
	margin-right: 0.5em;
	margin-top: 0.3em;
	margin-bottom: 0.3em;
	white-space: nowrap;
}

.collection-title {
	display: inline-block;
	margin-right: 1em;
}

.page-description {
    margin-bottom: 2em;
}

.simple-table {
	margin-top: 1em;
	font-size: 0.875rem;
	empty-cells: show;
}
.simple-table td {
	height: 29px;
	min-width: 120px;
}

.simple-table th {
	height: 29px;
	min-width: 120px;
}

.simple-table-header-color {
	background: rgb(247, 246, 243);
	color: black;
}
.simple-table-header {
	font-weight: 500;
}

time {
	opacity: 0.5;
}

.icon {
	display: inline-block;
	max-width: 1.2em;
	max-height: 1.2em;
	text-decoration: none;
	vertical-align: text-bottom;
	margin-right: 0.5em;
}

img.icon {
	border-radius: 3px;
}

.user-icon {
	width: 1.5em;
	height: 1.5em;
	border-radius: 100%;
	margin-right: 0.5rem;
}

.user-icon-inner {
	font-size: 0.8em;
}

.text-icon {
	border: 1px solid #000;
	text-align: center;
}

.page-cover-image {
	display: block;
	object-fit: cover;
	width: 100%;
	max-height: 30vh;
}

.page-header-icon {
	font-size: 3rem;
	margin-bottom: 1rem;
}

.page-header-icon-with-cover {
	margin-top: -0.72em;
	margin-left: 0.07em;
}

.page-header-icon img {
	border-radius: 3px;
}

.link-to-page {
	margin: 1em 0;
	padding: 0;
	border: none;
	font-weight: 500;
}

p > .user {
	opacity: 0.5;
}

td > .user,
td > time {
	white-space: nowrap;
}

input[type="checkbox"] {
	transform: scale(1.5);
	margin-right: 0.6em;
	vertical-align: middle;
}

p {
	margin-top: 0.5em;
	margin-bottom: 0.5em;
}

.image {
	border: none;
	margin: 1.5em 0;
	padding: 0;
	border-radius: 0;
	text-align: center;
}

.code,
code {
	background: rgba(135, 131, 120, 0.15);
	border-radius: 3px;
	padding: 0.2em 0.4em;
	border-radius: 3px;
	font-size: 85%;
	tab-size: 2;
}

code {
	color: #eb5757;
}

.code {
	padding: 1.5em 1em;
}

.code-wrap {
	white-space: pre-wrap;
	word-break: break-all;
}

.code > code {
	background: none;
	padding: 0;
	font-size: 100%;
	color: inherit;
}

blockquote {
	font-size: 1.25em;
	margin: 1em 0;
	padding-left: 1em;
	border-left: 3px solid rgb(55, 53, 47);
}

.bookmark {
	text-decoration: none;
	max-height: 8em;
	padding: 0;
	display: flex;
	width: 100%;
	align-items: stretch;
}

.bookmark-title {
	font-size: 0.85em;
	overflow: hidden;
	text-overflow: ellipsis;
	height: 1.75em;
	white-space: nowrap;
}

.bookmark-text {
	display: flex;
	flex-direction: column;
}

.bookmark-info {
	flex: 4 1 180px;
	padding: 12px 14px 14px;
	display: flex;
	flex-direction: column;
	justify-content: space-between;
}

.bookmark-image {
	width: 33%;
	flex: 1 1 180px;
	display: block;
	position: relative;
	object-fit: cover;
	border-radius: 1px;
}

.bookmark-description {
	color: rgba(55, 53, 47, 0.6);
	font-size: 0.75em;
	overflow: hidden;
	max-height: 4.5em;
	word-break: break-word;
}

.bookmark-href {
	font-size: 0.75em;
	margin-top: 0.25em;
}

.sans { font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; }
.code { font-family: "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace; }
.serif { font-family: Lyon-Text, Georgia, ui-serif, serif; }
.mono { font-family: iawriter-mono, Nitti, Menlo, Courier, monospace; }
.pdf .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK JP'; }
.pdf:lang(zh-CN) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC'; }
.pdf:lang(zh-TW) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK TC'; }
.pdf:lang(ko-KR) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK KR'; }
.pdf .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.pdf .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK JP'; }
.pdf:lang(zh-CN) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK SC'; }
.pdf:lang(zh-TW) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK TC'; }
.pdf:lang(ko-KR) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK KR'; }
.pdf .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.highlight-default {
	color: rgba(55, 53, 47, 1);
}
.highlight-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.highlight-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.highlight-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.highlight-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.highlight-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.highlight-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.highlight-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.highlight-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.highlight-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.highlight-default_background {
	color: rgba(55, 53, 47, 1);
}
.highlight-gray_background {
	background: rgba(241, 241, 239, 1);
}
.highlight-brown_background {
	background: rgba(244, 238, 238, 1);
}
.highlight-orange_background {
	background: rgba(251, 236, 221, 1);
}
.highlight-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.highlight-teal_background {
	background: rgba(237, 243, 236, 1);
}
.highlight-blue_background {
	background: rgba(231, 243, 248, 1);
}
.highlight-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.highlight-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.highlight-red_background {
	background: rgba(253, 235, 236, 1);
}
.block-color-default {
	color: inherit;
	fill: inherit;
}
.block-color-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.block-color-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.block-color-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.block-color-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.block-color-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.block-color-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.block-color-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.block-color-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.block-color-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.block-color-default_background {
	color: inherit;
	fill: inherit;
}
.block-color-gray_background {
	background: rgba(241, 241, 239, 1);
}
.block-color-brown_background {
	background: rgba(244, 238, 238, 1);
}
.block-color-orange_background {
	background: rgba(251, 236, 221, 1);
}
.block-color-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.block-color-teal_background {
	background: rgba(237, 243, 236, 1);
}
.block-color-blue_background {
	background: rgba(231, 243, 248, 1);
}
.block-color-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.block-color-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.block-color-red_background {
	background: rgba(253, 235, 236, 1);
}
.select-value-color-uiBlue { background-color: rgba(35, 131, 226, .07); }
.select-value-color-pink { background-color: rgba(245, 224, 233, 1); }
.select-value-color-purple { background-color: rgba(232, 222, 238, 1); }
.select-value-color-green { background-color: rgba(219, 237, 219, 1); }
.select-value-color-gray { background-color: rgba(227, 226, 224, 1); }
.select-value-color-transparentGray { background-color: rgba(227, 226, 224, 0); }
.select-value-color-translucentGray { background-color: rgba(0, 0, 0, 0.06); }
.select-value-color-orange { background-color: rgba(250, 222, 201, 1); }
.select-value-color-brown { background-color: rgba(238, 224, 218, 1); }
.select-value-color-red { background-color: rgba(255, 226, 221, 1); }
.select-value-color-yellow { background-color: rgba(253, 236, 200, 1); }
.select-value-color-blue { background-color: rgba(211, 229, 239, 1); }
.select-value-color-pageGlass { background-color: undefined; }
.select-value-color-washGlass { background-color: undefined; }

.checkbox {
	display: inline-flex;
	vertical-align: text-bottom;
	width: 16;
	height: 16;
	background-size: 16px;
	margin-left: 2px;
	margin-right: 5px;
}

.checkbox-on {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22%2358A9D7%22%2F%3E%0A%3Cpath%20d%3D%22M6.71429%2012.2852L14%204.9995L12.7143%203.71436L6.71429%209.71378L3.28571%206.2831L2%207.57092L6.71429%2012.2852Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fsvg%3E");
}

.checkbox-off {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20x%3D%220.75%22%20y%3D%220.75%22%20width%3D%2214.5%22%20height%3D%2214.5%22%20fill%3D%22white%22%20stroke%3D%22%2336352F%22%20stroke-width%3D%221.5%22%2F%3E%0A%3C%2Fsvg%3E");
}
	
</style></head><body><article id="04f35449-0ebf-458b-9883-a62d93539bd4" class="page sans"><header><h1 class="page-title">RockyLinux9+Zabbix6+Postgresql14のインストール</h1><p class="page-description"></p><table class="properties"><tbody><tr class="property-row property-row-multi_select"><th><span class="icon property-icon"><svg role="graphics-symbol" viewBox="0 0 16 16" style="width:14px;height:14px;display:block;fill:rgba(55, 53, 47, 0.45);flex-shrink:0" class="typesMultipleSelect"><path d="M1.91602 4.83789C2.44238 4.83789 2.87305 4.40723 2.87305 3.87402C2.87305 3.34766 2.44238 2.91699 1.91602 2.91699C1.38281 2.91699 0.952148 3.34766 0.952148 3.87402C0.952148 4.40723 1.38281 4.83789 1.91602 4.83789ZM5.1084 4.52344H14.3984C14.7607 4.52344 15.0479 4.23633 15.0479 3.87402C15.0479 3.51172 14.7607 3.22461 14.3984 3.22461H5.1084C4.74609 3.22461 4.45898 3.51172 4.45898 3.87402C4.45898 4.23633 4.74609 4.52344 5.1084 4.52344ZM1.91602 9.03516C2.44238 9.03516 2.87305 8.60449 2.87305 8.07129C2.87305 7.54492 2.44238 7.11426 1.91602 7.11426C1.38281 7.11426 0.952148 7.54492 0.952148 8.07129C0.952148 8.60449 1.38281 9.03516 1.91602 9.03516ZM5.1084 8.7207H14.3984C14.7607 8.7207 15.0479 8.43359 15.0479 8.07129C15.0479 7.70898 14.7607 7.42188 14.3984 7.42188H5.1084C4.74609 7.42188 4.45898 7.70898 4.45898 8.07129C4.45898 8.43359 4.74609 8.7207 5.1084 8.7207ZM1.91602 13.2324C2.44238 13.2324 2.87305 12.8018 2.87305 12.2686C2.87305 11.7422 2.44238 11.3115 1.91602 11.3115C1.38281 11.3115 0.952148 11.7422 0.952148 12.2686C0.952148 12.8018 1.38281 13.2324 1.91602 13.2324ZM5.1084 12.918H14.3984C14.7607 12.918 15.0479 12.6309 15.0479 12.2686C15.0479 11.9062 14.7607 11.6191 14.3984 11.6191H5.1084C4.74609 11.6191 4.45898 11.9062 4.45898 12.2686C4.45898 12.6309 4.74609 12.918 5.1084 12.918Z"></path></svg></span>タグ</th><td></td></tr></tbody></table></header><div class="page-body"><figure id="b4897f3a-d996-44b1-b9c2-589bfd1fa16b" class="image" style="text-align:left"><a href="RockyLinux9+Zabbix6+Postgresql14%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%2004f354490ebf458b9883a62d93539bd4/Zabbix_logo-RGB.png"><img style="width:336px" src="RockyLinux9+Zabbix6+Postgresql14%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%2004f354490ebf458b9883a62d93539bd4/Zabbix_logo-RGB.png"/></a></figure><p id="8a120bb4-4250-4ca8-9f38-e80213b921e3" class="">目次</p><nav id="833d1489-854a-45c0-a70f-7c3d40eb211f" class="block-color-gray table_of_contents"><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#1a8c904b-c0fd-4644-88fa-6488dfcde53f">はじめに</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#8bccae1d-eaf3-4166-9a2c-4cdc74050b63">Zabbix6の要件は以下になる</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#b0a41cfe-881f-4ffd-86ae-6f4e4bcf560e">OSの言語設定</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#19302cff-afb5-46bf-b050-a61b5cf573dd">Firewalldの無効化と停止</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#583a65ec-c433-48f8-bd37-939451eaba6d">レポジトリの追加</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#873c39ef-a4cb-4470-9a5e-a3392cdbd23f">Postgresqlのインストーとセットアップ</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#59827e16-651b-414b-bcd0-a54e0b0b6d65">Zabbixのインストール</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#b56ec925-ff8e-4409-8c7e-50923bcc17e8">2023/02/02 追記 TimescaleDBの追加</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#fb26a042-e085-437d-ac3b-d3ab7da24de9">Zabbix Proxyのインストール</a></div></nav><h1 id="1a8c904b-c0fd-4644-88fa-6488dfcde53f" class="">はじめに</h1><hr id="1289da9f-3730-80cd-9796-d8359930df5f"/><p id="05c5c5d7-fc8b-4eda-908c-21f30dbbb330" class="">RockyLinux9でZabbix6とPostgresql14を利用して自宅でZabbixを作ったナレッジです。</p><p id="ed9bd2c1-e29f-46b8-9f72-3aa99778f3c1" class="">以前MySQLを使った高可用性で作成しましたが、リソースを使うのでシンプルにシングル構成にしました。</p><p id="a48ed857-b799-42cc-90ae-9860abf213fc" class="">※その後、フロントUbutnu22.04でHA構成にして、DBをk8s基盤で動いているPostgresOperatorで動かしました。</p><h1 id="8bccae1d-eaf3-4166-9a2c-4cdc74050b63" class="">Zabbix6の要件は以下になる</h1><hr id="1289da9f-3730-8092-9cf7-c51f722cbe5c"/><figure id="582b6135-94fb-4ade-97bf-bb29db676711"><a href="https://www.zabbix.com/documentation/6.0/jp/manual/installation/requirements" class="bookmark source"><div class="bookmark-info"><div class="bookmark-text"><div class="bookmark-title">2 要件</div></div><div class="bookmark-href"><img src="https://www.zabbix.com/documentation/6.0/images/apple-touch-icon.png" class="icon bookmark-icon"/>https://www.zabbix.com/documentation/6.0/jp/manual/installation/requirements</div></div></a></figure><h1 id="b0a41cfe-881f-4ffd-86ae-6f4e4bcf560e" class="">OSの言語設定</h1><hr id="1289da9f-3730-80d9-ac4f-cb5edba5eb25"/><p id="649f1808-916a-4d4a-9051-07051c34bd5a" class="">デフォルトでは以下となっていましたので、日本語を追加します。</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="3293a56c-0762-4261-b66c-160b915fe150" class="code"><code class="language-Bash"># localectl
System Locale: LANG=C.UTF-8
VC Keymap: jp
X11 Layout: jp</code></pre><p id="14f2f14a-69e3-46b3-a634-bb09c4b7c926" class="">以下コマンドで日本語PKGを追加してデフォルト言語を設定します。</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="9eddfb38-d386-48fe-9cf0-f9c88fa206f0" class="code"><code class="language-Bash"># dnf -y install langpacks-ja glibc-langpack-ja
# localectl set-locale LANG=ja_JP.UTF-8</code></pre><p id="e78aefda-ef05-41b1-90f0-edc96482ba34" class="">設定後デフォルトになっていることを確認します。</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="ee0c87e0-5616-41a9-a095-5008a8f833bc" class="code"><code class="language-Bash"># localectl 
   System Locale: LANG=ja_JP.UTF-8
       VC Keymap: jp
      X11 Layout: jp</code></pre><h1 id="19302cff-afb5-46bf-b050-a61b5cf573dd" class="">Firewalldの無効化と停止</h1><hr id="1289da9f-3730-807d-81f6-f9b09af7cb47"/><p id="366fe02d-fe45-4ba4-b008-3b1078a25807" class="">必要なポート開ければ良いですが、Firewallを今回は無効化して停止します。</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="7f1cce90-26a3-4811-91b6-6d15e438f755" class="code"><code class="language-YAML"># systemctl disable firewalld
Removed &quot;/etc/systemd/system/multi-user.target.wants/firewalld.service&quot;.
Removed &quot;/etc/systemd/system/dbus-org.fedoraproject.FirewallD1.service&quot;.
# systemctl stop firewalld</code></pre><h1 id="583a65ec-c433-48f8-bd37-939451eaba6d" class="">レポジトリの追加</h1><hr id="1289da9f-3730-8040-bde3-f9b698789225"/><p id="11318a2a-bbd4-4ed7-8376-5d1080c40e4c" class="">ZabbixとPostgresqlのリポジトリを追加します。</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="0b674047-541f-4378-91eb-9198ea8f0a05" class="code"><code class="language-Bash"># rpm -Uvh https://repo.zabbix.com/zabbix/6.0/rhel/9/x86_64/zabbix-release-6.0-4.el9.noarch.rpm
# dnf install -y https://download.postgresql.org/pub/repos/yum/reporpms/EL-9-x86_64/pgdg-redhat-repo-latest.noarch.rpm</code></pre><h1 id="873c39ef-a4cb-4470-9a5e-a3392cdbd23f" class="">Postgresqlのインストーとセットアップ</h1><hr id="1289da9f-3730-80d9-9b75-f952dad976f6"/><p id="56cf6411-7ec2-4359-84d5-8dd16c371a5f" class="">デフォルトのPostgreSQLを無効化してリポジトリから持ってきたPostgreSQLをインストールします。</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="89a6a2d0-31f8-448d-8808-476947f75d04" class="code"><code class="language-Bash"># dnf -qy module disable postgresql
# dnf update -y
# dnf install -y postgresql14-server</code></pre><p id="bb75a78f-280b-46a0-949f-c1b9848fab58" class="">インストールしたらPostgreSQLのセットアップを実施と起動ならびに自動起動の有効化を行います。</p><p id="76b27f09-5110-473d-b078-5dcdeab6b145" class="">起動後にpsqlで接続ができることを確認しております。</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="00e35ead-3619-496d-b4f4-35f8e8c72511" class="code"><code class="language-Bash"># /usr/pgsql-14/bin/postgresql-14-setup initdb
Initializing database ... OK

# systemctl enable postgresql-14
Created symlink /etc/systemd/system/multi-user.target.wants/postgresql-14.service → /usr/lib/systemd/system/postgresql-14.service.

# systemctl start postgresql-14
# systemctl status postgresql-14
● postgresql-14.service - PostgreSQL 14 database server
     Loaded: loaded (/usr/lib/systemd/system/postgresql-14.service; enabled; vendor preset: disabled)
     Active: active (running) since Tue 2023-01-31 19:49:04 JST; 3s ago
       Docs: https://www.postgresql.org/docs/14/static/
    Process: 22434 ExecStartPre=/usr/pgsql-14/bin/postgresql-14-check-db-dir ${PGDATA} (code=exited, status=0/SUCCESS)
   Main PID: 22439 (postmaster)
      Tasks: 8 (limit: 50518)
     Memory: 16.6M
        CPU: 39ms
     CGroup: /system.slice/postgresql-14.service
             ├─22439 /usr/pgsql-14/bin/postmaster -D /var/lib/pgsql/14/data/
             ├─22440 &quot;postgres: logger &quot;
             ├─22442 &quot;postgres: checkpointer &quot;
             ├─22443 &quot;postgres: background writer &quot;
             ├─22444 &quot;postgres: walwriter &quot;
             ├─22445 &quot;postgres: autovacuum launcher &quot;
             ├─22446 &quot;postgres: stats collector &quot;
             └─22447 &quot;postgres: logical replication launcher &quot;

Jan 31 19:49:04 ray-zbx6 systemd[1]: Starting PostgreSQL 14 database server...
Jan 31 19:49:04 ray-zbx6 postmaster[22439]: 2023-01-31 19:49:04.047 JST [22439] LOG:  redirecting log output to logging collector process
Jan 31 19:49:04 ray-zbx6 postmaster[22439]: 2023-01-31 19:49:04.047 JST [22439] HINT:  Future log output will appear in directory &quot;log&quot;.
Jan 31 19:49:04 ray-zbx6 systemd[1]: Started PostgreSQL 14 database server.

# sudo -i -u postgres psql
SELECT version();
                                                 version                                                  
----------------------------------------------------------------------------------------------------------
 PostgreSQL 14.6 on x86_64-pc-linux-gnu, compiled by gcc (GCC) 11.2.1 20220127 (Red Hat 11.2.1-9), 64-bit
(1 row)

$ ¥q</code></pre><h1 id="59827e16-651b-414b-bcd0-a54e0b0b6d65" class="">Zabbixのインストール</h1><hr id="1289da9f-3730-807e-b1c0-fce68b15d858"/><p id="c7d4d9d5-ab35-4507-baf3-5c80836494d4" class="">必要なPKGをインストールします。</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1dd8dc38-ffcd-42bd-91f9-6b48f6248a9c" class="code"><code class="language-Bash"># dnf install zabbix-server-pgsql zabbix-web-pgsql zabbix-apache-conf zabbix-sql-scripts zabbix-selinux-policy zabbix-agent2 zabbix-web-japanese</code></pre><p id="83cf98c5-345d-43c8-aa68-d52993ec1aa4" class="">Zabbixに必要なDBを作るために、PostgreSQLのpostgresユーザーにパスワードを付与します。</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="bfcb0ffa-3bdc-4931-80a5-aa1791c5eb4f" class="code"><code class="language-Bash"># sudo -u postgres psql -c &quot;alter user postgres with password &#x27;postgres&#x27;&quot;</code></pre><p id="7d9bc45d-af53-44aa-afa4-844a86c62440" class="">pg_hba.confを編集し、パスワード認証を設定します。</p><p id="e12cd16c-b2a0-4ebe-96aa-a89e25c3c529" class="">なお、scram-sha-256 認証方式を利用をします。</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="b42d0692-45f1-400c-b27f-10feceb39203" class="code"><code class="language-Bash"># vi /var/lib/pgsql/14/data/pg_hba.conf
# &quot;local&quot; is for Unix domain socket connections only
local   all             all                                     scram-sha-256
# IPv4 local connections:
host    all             all             127.0.0.1/32            scram-sha-256
# IPv6 local connections:
host    all             all             ::1/128                 scram-sha-256</code></pre><p id="84943e6e-8687-4311-b3d5-f1ceb73bcb77" class="">ZabbixユーザーならびにZabbixのデータベースを作成します。</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="a4ed748c-e069-4818-8527-020a7e37a7c8" class="code"><code class="language-Bash"># useradd zabbix-user
# sudo -u postgres createuser --pwprompt zabbix-user
could not change directory to &quot;/root&quot;: Permission denied
Enter password for new role: zabbix #設定したいパスワード
Enter it again: zabbix #設定したいパスワード

# sudo -u postgres createdb -O zabbix-user zabbix
could not change directory to &quot;/root&quot;: Permission denied
Password: postgres #postgresユーザーのパスワード

# zcat /usr/share/zabbix-sql-scripts/postgresql/server.sql.gz | sudo -u zabbix-user psql zabbix</code></pre><p id="a6ba5399-1d3f-4147-95c6-b1c8eec2b5f1" class="">ZabbixServerの設定を編集します。編集する箇所はDBに周りの設定になります。</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="b8bab303-ba9c-49ca-ae90-c2b1b3401778" class="code"><code class="language-Bash"># vi /etc/zabbix/zabbix_server.conf
DBName=zabbix
DBUser=zabbix-user
DBPassword=zabbix
ProxyConfigFrequency=60　#Proxyとの同期間隔</code></pre><p id="16f8f0de-53b7-4faa-a171-30877c7cec80" class="">ZabbixAgentの設定を編集します。編集する箇所は監視する際に必要な箇所になります。</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="baae9d19-29a3-4c04-85cf-fbc9863a69a4" class="code"><code class="language-Bash"># vi /etc/zabbix/zabbix_agent2.conf
Server=192.168.11.62 #ZabbixサーバもしくはプロキシのIP
ServerActive=192.168.11.62 #ZabbixサーバもしくはプロキシのIP
Hostname=ray-zbx6 #任意でわかりやすい名前</code></pre><p id="80a1eabe-b4c9-46cb-b413-03b2af742f38" class="">zabbix-server, zabbix-agent2, httpd, php-fpm の起動・自動起動有効化をします。</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="4b2e46df-e493-420e-8f2d-c91d6c47c7b9" class="code"><code class="language-Bash"># systemctl restart zabbix-server zabbix-agent2 httpd php-fpm
# systemctl enable zabbix-server zabbix-agent2 httpd php-fpm
# systemctl status zabbix-server zabbix-agent2 httpd php-fpm</code></pre><p id="e88408e9-7cfa-443b-ab5a-a3b71e888118" class="">http://IPアドレス/zabbixをブラウザで開いたらデフォルトの言語を日本語にすることで以下画面になると思います。</p><figure id="bd04789c-10b5-4564-ab7f-f6fe34f97bc6" class="image" style="text-align:left"><a href="RockyLinux9+Zabbix6+Postgresql14%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%2004f354490ebf458b9883a62d93539bd4/Untitled.png"><img style="width:528px" src="RockyLinux9+Zabbix6+Postgresql14%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%2004f354490ebf458b9883a62d93539bd4/Untitled.png"/></a></figure><p id="73485bea-9df4-4f76-b7c2-c6650fd802c2" class="">インストールするにあたっての前提条件のチェックがあるのでALL OKになっていることを確認します。</p><figure id="b7973f29-ba97-4be7-917f-4423dea851a4" class="image" style="text-align:left"><a href="RockyLinux9+Zabbix6+Postgresql14%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%2004f354490ebf458b9883a62d93539bd4/Untitled%201.png"><img style="width:528px" src="RockyLinux9+Zabbix6+Postgresql14%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%2004f354490ebf458b9883a62d93539bd4/Untitled%201.png"/></a></figure><p id="c8772bca-e770-45ee-a7f1-8ec5e7dfd72e" class="">Database TLS encryptionはチェック外しました。</p><p id="33bbc168-e986-47be-b1b2-af7ce260ec6f" class="">トランスポート暗号化を有効したい場合にはチェックを入れてください。</p><p id="9311ae3a-d69e-431a-9cce-62b2a1f3b6ec" class="">そのほかはデータベース名やユーザー、パスワードといったところを入力してください。</p><figure id="e839569e-63a0-48dd-8c0f-05dbd44a30e3" class="image" style="text-align:left"><a href="RockyLinux9+Zabbix6+Postgresql14%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%2004f354490ebf458b9883a62d93539bd4/Untitled%202.png"><img style="width:528px" src="RockyLinux9+Zabbix6+Postgresql14%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%2004f354490ebf458b9883a62d93539bd4/Untitled%202.png"/></a></figure><p id="1179fe95-03e9-42e1-9a6b-8ac7b388f1fc" class="">サーバ名はわかりやすい名前にし、タイムゾーンはAsia/Tokyoにしました。</p><p id="f6f5f35e-f407-42cd-97be-f20446b85606" class="">テーマはお好みで。</p><figure id="c8e319f2-7627-455c-aae4-663dfe826c4a" class="image" style="text-align:left"><a href="RockyLinux9+Zabbix6+Postgresql14%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%2004f354490ebf458b9883a62d93539bd4/Untitled%203.png"><img style="width:528px" src="RockyLinux9+Zabbix6+Postgresql14%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%2004f354490ebf458b9883a62d93539bd4/Untitled%203.png"/></a></figure><p id="2fc2e2f6-c9e0-4d08-b17e-5c08c26a4456" class="">最後に設定値の確認がでるので確認します。</p><figure id="0ad3002d-7d86-4fdf-8505-009fd8f4ffb8" class="image" style="text-align:left"><a href="RockyLinux9+Zabbix6+Postgresql14%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%2004f354490ebf458b9883a62d93539bd4/Untitled%204.png"><img style="width:528px" src="RockyLinux9+Zabbix6+Postgresql14%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%2004f354490ebf458b9883a62d93539bd4/Untitled%204.png"/></a></figure><p id="23897c9e-8e93-45a5-b524-2fa18c0f237d" class="">インストールが完了すると以下の画面が表示されます。</p><figure id="09c9e612-f054-499e-9d83-f36cf49fd5e5" class="image" style="text-align:left"><a href="RockyLinux9+Zabbix6+Postgresql14%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%2004f354490ebf458b9883a62d93539bd4/Untitled%205.png"><img style="width:528px" src="RockyLinux9+Zabbix6+Postgresql14%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%2004f354490ebf458b9883a62d93539bd4/Untitled%205.png"/></a></figure><p id="375ece97-0897-4c0c-b067-41ddf03a4ad1" class="">ログイン画面がでるのでユーザー名：Admin、パスワード：zabbixにしてログインします。</p><figure id="36179516-3fdf-46da-8cb6-158dda12a800" class="image" style="text-align:left"><a href="RockyLinux9+Zabbix6+Postgresql14%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%2004f354490ebf458b9883a62d93539bd4/Untitled%206.png"><img style="width:336px" src="RockyLinux9+Zabbix6+Postgresql14%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%2004f354490ebf458b9883a62d93539bd4/Untitled%206.png"/></a></figure><p id="24326141-9f5c-4862-9216-2f4320a60324" class="">ログインしたらZabbix Serverの名前をzabbix_agent2.confで設定した名前に変更、IPアドレスも同様に変更します。</p><figure id="b4a6b540-d6ba-4d86-a1e4-020d21023935" class="image" style="text-align:left"><a href="RockyLinux9+Zabbix6+Postgresql14%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%2004f354490ebf458b9883a62d93539bd4/Untitled%207.png"><img style="width:259px" src="RockyLinux9+Zabbix6+Postgresql14%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%2004f354490ebf458b9883a62d93539bd4/Untitled%207.png"/></a></figure><p id="d311ef4b-450e-407e-9650-a296c5d27038" class="">
</p><p id="c3c7f613-9c15-4fbe-a5fb-05284f004b8e" class="">その後、エージェントの状態のZBXが緑色になっていれば正常となりインストールは完了となります。</p><figure id="7a16f0ff-ebad-4569-8b69-874a7a880b5d" class="image" style="text-align:left"><a href="RockyLinux9+Zabbix6+Postgresql14%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%2004f354490ebf458b9883a62d93539bd4/Untitled%208.png"><img style="width:443px" src="RockyLinux9+Zabbix6+Postgresql14%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%2004f354490ebf458b9883a62d93539bd4/Untitled%208.png"/></a></figure><h1 id="b56ec925-ff8e-4409-8c7e-50923bcc17e8" class="">2023/02/02 追記 TimescaleDBの追加</h1><hr id="1289da9f-3730-8051-9565-e99078a3321f"/><p id="e2009414-6ec1-4fc3-8d74-13c8f1f6d510" class="">TimescaleDBを追加することで性能向上やディスク使用量の削減に期待していきます。</p><p id="473de72a-48f2-4094-9564-0ddd4f4492ae" class="">時系列DBの機能を適用した親テーブルをハイパーテーブルと呼び、データ内部はチャンクと呼ばれるテーブルに分割されます。</p><p id="0806f128-f80b-477a-83db-1b2c103046fc" class="">また恩恵としてディスク領域の節約やHousekeeper による削除処理の負荷軽減に繋がりそうなので導入していきます。</p><p id="7ce1794e-0d4d-4fbc-ba7d-20424023cc1d" class="">以下が導入手順です。</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="a531b8cb-3aeb-412e-933a-46c64142ee6e" class="code"><code class="language-Bash"># リポジトリを追加します。
# tee /etc/yum.repos.d/timescale_timescaledb.repo &lt;&lt;EOL
[timescale_timescaledb]
name=timescale_timescaledb
baseurl=https://packagecloud.io/timescale/timescaledb/el/$(rpm -E %{rhel})/\$basearch
repo_gpgcheck=1
gpgcheck=0
enabled=1
gpgkey=https://packagecloud.io/timescale/timescaledb/gpgkey
sslverify=1
sslcacert=/etc/pki/tls/certs/ca-bundle.crt
metadata_expire=300
EOL

# timescaledbをインストールします
# dnf install timescaledb-2-postgresql-14

# timescaledb-tuneコマンドを使用してPostgresqlのチューニングをします。max-connsを使って接続数を明示的に指定しています。
# timescaledb-tune --pg-config=/usr/pgsql-14/bin/pg_config --max-conns=100

# postgresqlの再起動
# systemctl restart postgresql-14

# zabbix データベースに TimesaceleDB 拡張をインストール
# echo &quot;CREATE EXTENSION IF NOT EXISTS timescaledb CASCADE;&quot; | sudo -u zabbix-user psql zabbix

# TimescaleDB のスキーマ作成スクリプト timescaledb.sql を実行
# cat /usr/share/zabbix-sql-scripts/postgresql/timescaledb.sql | sudo -u zabbix-user psql zabbix

# /etc/zabbix/zabbix_server.confに以下追記（サポートしていないTimesacleDBバージョンを利用する場合）
AllowUnsupportedDBVersions=1</code></pre><h1 id="fb26a042-e085-437d-ac3b-d3ab7da24de9" class="">Zabbix Proxyのインストール</h1><hr id="1289da9f-3730-8005-b1bf-e12693b6d5d6"/><p id="0e0df70b-61df-4fc8-969c-d223f29075bd" class="">リポジトリ追加やPostgreSQLインストールまでは同じです。</p><p id="eac16d56-a112-4630-804b-9945d337e3c8" class="">以下からZabbixProxyの手順になります。</p><p id="8b34045e-94ab-429b-8a03-4c369df28400" class="">※ZabbixServerとは別のサーバで実施しています。</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="2f1f1062-1cc3-40df-bdaa-0e8e1e73702c" class="code"><code class="language-Bash"># dnf install zabbix-proxy-pgsql zabbix-sql-scripts zabbix-selinux-policy
# sudo -u postgres createuser --pwprompt zabbix
# sudo -u postgres createdb -O zabbix zabbix_proxy
# cat /usr/share/zabbix-sql-scripts/postgresql/proxy.sql | sudo -u zabbix psql zabbix_proxy
# vi /etc/zabbix/zabbix_proxy.conf
Server=ZabbixServerのIPアドレス
Hostname=ZabbixServerのプロキシに登録するホスト名
DBPassword=zabbix
ConfigFrequency=60 #Serverとの同期間隔

# systemctl restart zabbix-proxy
# systemctl enable zabbix-proxy</code></pre><p id="4b0f4aaf-4e67-4f72-a9e1-ce38b55b47af" class="">以下画面でZabbixProxyで設定したHostname欄の内容を、プロキシ名に追加します。</p><p id="78611e14-a5a3-41fe-bab4-263a6aba5065" class="">追加後に最新データ受信時刻が更新されていればOKです。</p><p id="e56cb37e-9dd6-4b5f-82c1-6e4fc4c65066" class="">未同期の場合にはZabbixProxyのログやZabbixServerのログを見てみてください。</p><figure id="e6198d05-3633-4cb7-b9f5-561c60904cd7" class="image" style="text-align:left"><a href="RockyLinux9+Zabbix6+Postgresql14%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%2004f354490ebf458b9883a62d93539bd4/Untitled%209.png"><img style="width:720px" src="RockyLinux9+Zabbix6+Postgresql14%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%2004f354490ebf458b9883a62d93539bd4/Untitled%209.png"/></a></figure></div></article><span class="sans" style="font-size:14px;padding-top:2em"></span></body></html>