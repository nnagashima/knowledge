# UbuntuOSの初期設定

タグ: Ubuntu

![ubuntu_14143.png](UbuntuOS%E3%81%AE%E5%88%9D%E6%9C%9F%E8%A8%AD%E5%AE%9A%20f8933b6457e64efcbc802962379dca6c/ubuntu_14143.png)

目次

# はじめに

---

個人的に実施する初期設定の内容を以下に記載していきます。

# ホスト名の設定

---

```jsx
# hostnamectl set-hostname HOST名
# uanme -n
HOST名
```

# Firewallの無効化

---

Firewall設定の確認して無効化であればOK

```jsx
# ufw status
状態: 非アクティブ
```

無効化するのであれば以下コマンドを実行

```jsx
# ufw disable
```

# OSの日本語化（日本語にしたい場合）

---

日本語関連パッケージのインストール

```jsx
# apt -y install language-pack-ja-base language-pack-ja
```

システムのロケールを日本語(UTF-8)へ設定と確認

```jsx
# localectl set-locale LANG=ja_JP.UTF-8 LANGUAGE="ja_JP:ja"
# source /etc/default/locale
# localectl status
   System Locale: LANG=ja_JP.UTF-8
                  LANGUAGE=ja_JP:ja
       VC Keymap: n/a
      X11 Layout: us
       X11 Model: pc105
       
#英語から日本語に戻したい場合は以下の通り
# localectl set-locale LANG=en_US.UTF-8 LANGUAGE="en_US:en"
```

# TimeZone設定

---

タイムゾーンを日本時間(JST)に変更

```jsx
# timedatectl set－timezone Asia/Tokyo
# timedatectl status
               Local time: 水 2024-01-10 13:31:56 JST
           Universal time: 水 2024-01-10 04:31:56 UTC
                 RTC time: n/a
                Time zone: Asia/Tokyo (JST, +0900)
System clock synchronized: yes
              NTP service: active
          RTC in local TZ: no
```

# ユーザーの追加

---

adduserで追加します。useraddだとhomeディレクトリが作成されません。

```jsx
# adduser user名
ユーザー `test' を追加しています...
新しいグループ `test' (1002) を追加しています...
新しいユーザー `test' (1002) をグループ `test' に追加しています...
ホームディレクトリ `/home/test' を作成しています...
`/etc/skel' からファイルをコピーしています...
新しい パスワード: 
新しい パスワードを再入力してください: 
passwd: パスワードは正しく更新されました
test のユーザ情報を変更中
新しい値を入力してください。標準設定値を使うならリターンを押してください
        フルネーム []: 
        部屋番号 []: 
        職場電話番号 []: 
        自宅電話番号 []: 
        その他 []: 
以上で正しいですか? [Y/n]
```

# sudoグループへの追加

---

追加したユーザーにsudo権限を与える場合は以下を実行してsudoグループに追加します。

```jsx
# gpasswd -a user名 sudo
```

# Network設定

---

/etc/netplan/99-config.yamlを作成してネットワーク設定を実施します。

今回はens18に

- IPv4アドレス 192.168.21.100
- サブネットマスク 255.255.255.0 ( /24 )
- デフォルトゲートウェイ 192.168.21.254
- DNS 192.168.21.5 192.168.21.6

```jsx
network:
  version: 2
  renderer: networkd
  ethernets:
    ens160:
      dhcp4: false
      addresses:
        - 192.168.21.100/24
      routes:
        - to: default
          via: 192.168.21.254
      nameservers:
        addresses: [192.168.21.5,192.168.21.6]
```

以下コマンドで反映させます。

```jsx
# chmod 600 /etc/netplan/99-config.yaml
# netplan apply
```

systemd-resolvedはスタブリゾルバ（DNSクライアント）なので、自身で名前解決は出来ませんが、レスポンスタイムを短縮をしてくれますが、

自身で作ったDNSを直接参照させたいのでlocal DNS stub listener の利用をやめます。

```tsx
# vi /etc/systemd/resolved.conf
[Resolve]
DNSStubListener=no
```

systemd-resolvedを再起動します。

```tsx
# systemctl restart systemd-resolved
```

# NTP設定

---

NTP=の部分を同期先に指定することで設定ができます。

今回はNTPの同期先をAWSにします。

```jsx
# vi /etc/systemd/timesyncd.conf
NTP=time.aws.com

# systemctl restart systemd-timesyncd
# timedatectl timesync-status 
       Server: 15.168.66.130 (time.aws.com)
Poll interval: 1min 4s (min: 32s; max 34min 8s)
         Leap: normal
      Version: 4
      Stratum: 4
    Reference: A9FEA97B
    Precision: 4us (-18)
Root distance: 640us (max: 5s)
       Offset: -1.284ms
        Delay: 17.158ms
       Jitter: 0
 Packet count: 1
    Frequency: -16.881ppm
```

# ログローテート

---

```jsx
標準から90日分の保存に世代を伸ばしており、ファイル名の末尾にYYYYMMDDとつくようにしています。

# cat /etc/logrote.conf
# see "man logrotate" for details

# global options do not affect preceding include directives

# rotate log files weekly
daily

# use the adm group by default, since this is the owning group
# of /var/log/.
su root adm

# keep 4 weeks worth of backlogs
rotate 90

# create new (empty) log files after rotating old ones
create

# use date as a suffix of the rotated file
dateext

# uncomment this if you want your log files compressed
compress

# packages drop log rotation information into this directory
include /etc/logrotate.d

# system-specific logs may also be configured here.
```