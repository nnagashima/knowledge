<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>IISを利用したリバースプロキシの構築</title><style>
/* cspell:disable-file */
/* webkit printing magic: print all background colors */
html {
	-webkit-print-color-adjust: exact;
}
* {
	box-sizing: border-box;
	-webkit-print-color-adjust: exact;
}

html,
body {
	margin: 0;
	padding: 0;
}
@media only screen {
	body {
		margin: 2em auto;
		max-width: 900px;
		color: rgb(55, 53, 47);
	}
}

body {
	line-height: 1.5;
	white-space: pre-wrap;
}

a,
a.visited {
	color: inherit;
	text-decoration: underline;
}

.pdf-relative-link-path {
	font-size: 80%;
	color: #444;
}

h1,
h2,
h3 {
	letter-spacing: -0.01em;
	line-height: 1.2;
	font-weight: 600;
	margin-bottom: 0;
}

.page-title {
	font-size: 2.5rem;
	font-weight: 700;
	margin-top: 0;
	margin-bottom: 0.75em;
}

h1 {
	font-size: 1.875rem;
	margin-top: 1.875rem;
}

h2 {
	font-size: 1.5rem;
	margin-top: 1.5rem;
}

h3 {
	font-size: 1.25rem;
	margin-top: 1.25rem;
}

.source {
	border: 1px solid #ddd;
	border-radius: 3px;
	padding: 1.5em;
	word-break: break-all;
}

.callout {
	border-radius: 3px;
	padding: 1rem;
}

figure {
	margin: 1.25em 0;
	page-break-inside: avoid;
}

figcaption {
	opacity: 0.5;
	font-size: 85%;
	margin-top: 0.5em;
}

mark {
	background-color: transparent;
}

.indented {
	padding-left: 1.5em;
}

hr {
	background: transparent;
	display: block;
	width: 100%;
	height: 1px;
	visibility: visible;
	border: none;
	border-bottom: 1px solid rgba(55, 53, 47, 0.09);
}

img {
	max-width: 100%;
}

@media only print {
	img {
		max-height: 100vh;
		object-fit: contain;
	}
}

@page {
	margin: 1in;
}

.collection-content {
	font-size: 0.875rem;
}

.column-list {
	display: flex;
	justify-content: space-between;
}

.column {
	padding: 0 1em;
}

.column:first-child {
	padding-left: 0;
}

.column:last-child {
	padding-right: 0;
}

.table_of_contents-item {
	display: block;
	font-size: 0.875rem;
	line-height: 1.3;
	padding: 0.125rem;
}

.table_of_contents-indent-1 {
	margin-left: 1.5rem;
}

.table_of_contents-indent-2 {
	margin-left: 3rem;
}

.table_of_contents-indent-3 {
	margin-left: 4.5rem;
}

.table_of_contents-link {
	text-decoration: none;
	opacity: 0.7;
	border-bottom: 1px solid rgba(55, 53, 47, 0.18);
}

table,
th,
td {
	border: 1px solid rgba(55, 53, 47, 0.09);
	border-collapse: collapse;
}

table {
	border-left: none;
	border-right: none;
}

th,
td {
	font-weight: normal;
	padding: 0.25em 0.5em;
	line-height: 1.5;
	min-height: 1.5em;
	text-align: left;
}

th {
	color: rgba(55, 53, 47, 0.6);
}

ol,
ul {
	margin: 0;
	margin-block-start: 0.6em;
	margin-block-end: 0.6em;
}

li > ol:first-child,
li > ul:first-child {
	margin-block-start: 0.6em;
}

ul > li {
	list-style: disc;
}

ul.to-do-list {
	padding-inline-start: 0;
}

ul.to-do-list > li {
	list-style: none;
}

.to-do-children-checked {
	text-decoration: line-through;
	opacity: 0.375;
}

ul.toggle > li {
	list-style: none;
}

ul {
	padding-inline-start: 1.7em;
}

ul > li {
	padding-left: 0.1em;
}

ol {
	padding-inline-start: 1.6em;
}

ol > li {
	padding-left: 0.2em;
}

.mono ol {
	padding-inline-start: 2em;
}

.mono ol > li {
	text-indent: -0.4em;
}

.toggle {
	padding-inline-start: 0em;
	list-style-type: none;
}

/* Indent toggle children */
.toggle > li > details {
	padding-left: 1.7em;
}

.toggle > li > details > summary {
	margin-left: -1.1em;
}

.selected-value {
	display: inline-block;
	padding: 0 0.5em;
	background: rgba(206, 205, 202, 0.5);
	border-radius: 3px;
	margin-right: 0.5em;
	margin-top: 0.3em;
	margin-bottom: 0.3em;
	white-space: nowrap;
}

.collection-title {
	display: inline-block;
	margin-right: 1em;
}

.page-description {
    margin-bottom: 2em;
}

.simple-table {
	margin-top: 1em;
	font-size: 0.875rem;
	empty-cells: show;
}
.simple-table td {
	height: 29px;
	min-width: 120px;
}

.simple-table th {
	height: 29px;
	min-width: 120px;
}

.simple-table-header-color {
	background: rgb(247, 246, 243);
	color: black;
}
.simple-table-header {
	font-weight: 500;
}

time {
	opacity: 0.5;
}

.icon {
	display: inline-block;
	max-width: 1.2em;
	max-height: 1.2em;
	text-decoration: none;
	vertical-align: text-bottom;
	margin-right: 0.5em;
}

img.icon {
	border-radius: 3px;
}

.user-icon {
	width: 1.5em;
	height: 1.5em;
	border-radius: 100%;
	margin-right: 0.5rem;
}

.user-icon-inner {
	font-size: 0.8em;
}

.text-icon {
	border: 1px solid #000;
	text-align: center;
}

.page-cover-image {
	display: block;
	object-fit: cover;
	width: 100%;
	max-height: 30vh;
}

.page-header-icon {
	font-size: 3rem;
	margin-bottom: 1rem;
}

.page-header-icon-with-cover {
	margin-top: -0.72em;
	margin-left: 0.07em;
}

.page-header-icon img {
	border-radius: 3px;
}

.link-to-page {
	margin: 1em 0;
	padding: 0;
	border: none;
	font-weight: 500;
}

p > .user {
	opacity: 0.5;
}

td > .user,
td > time {
	white-space: nowrap;
}

input[type="checkbox"] {
	transform: scale(1.5);
	margin-right: 0.6em;
	vertical-align: middle;
}

p {
	margin-top: 0.5em;
	margin-bottom: 0.5em;
}

.image {
	border: none;
	margin: 1.5em 0;
	padding: 0;
	border-radius: 0;
	text-align: center;
}

.code,
code {
	background: rgba(135, 131, 120, 0.15);
	border-radius: 3px;
	padding: 0.2em 0.4em;
	border-radius: 3px;
	font-size: 85%;
	tab-size: 2;
}

code {
	color: #eb5757;
}

.code {
	padding: 1.5em 1em;
}

.code-wrap {
	white-space: pre-wrap;
	word-break: break-all;
}

.code > code {
	background: none;
	padding: 0;
	font-size: 100%;
	color: inherit;
}

blockquote {
	font-size: 1.25em;
	margin: 1em 0;
	padding-left: 1em;
	border-left: 3px solid rgb(55, 53, 47);
}

.bookmark {
	text-decoration: none;
	max-height: 8em;
	padding: 0;
	display: flex;
	width: 100%;
	align-items: stretch;
}

.bookmark-title {
	font-size: 0.85em;
	overflow: hidden;
	text-overflow: ellipsis;
	height: 1.75em;
	white-space: nowrap;
}

.bookmark-text {
	display: flex;
	flex-direction: column;
}

.bookmark-info {
	flex: 4 1 180px;
	padding: 12px 14px 14px;
	display: flex;
	flex-direction: column;
	justify-content: space-between;
}

.bookmark-image {
	width: 33%;
	flex: 1 1 180px;
	display: block;
	position: relative;
	object-fit: cover;
	border-radius: 1px;
}

.bookmark-description {
	color: rgba(55, 53, 47, 0.6);
	font-size: 0.75em;
	overflow: hidden;
	max-height: 4.5em;
	word-break: break-word;
}

.bookmark-href {
	font-size: 0.75em;
	margin-top: 0.25em;
}

.sans { font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; }
.code { font-family: "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace; }
.serif { font-family: Lyon-Text, Georgia, ui-serif, serif; }
.mono { font-family: iawriter-mono, Nitti, Menlo, Courier, monospace; }
.pdf .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK JP'; }
.pdf:lang(zh-CN) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC'; }
.pdf:lang(zh-TW) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK TC'; }
.pdf:lang(ko-KR) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK KR'; }
.pdf .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.pdf .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK JP'; }
.pdf:lang(zh-CN) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK SC'; }
.pdf:lang(zh-TW) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK TC'; }
.pdf:lang(ko-KR) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK KR'; }
.pdf .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.highlight-default {
	color: rgba(55, 53, 47, 1);
}
.highlight-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.highlight-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.highlight-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.highlight-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.highlight-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.highlight-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.highlight-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.highlight-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.highlight-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.highlight-default_background {
	color: rgba(55, 53, 47, 1);
}
.highlight-gray_background {
	background: rgba(241, 241, 239, 1);
}
.highlight-brown_background {
	background: rgba(244, 238, 238, 1);
}
.highlight-orange_background {
	background: rgba(251, 236, 221, 1);
}
.highlight-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.highlight-teal_background {
	background: rgba(237, 243, 236, 1);
}
.highlight-blue_background {
	background: rgba(231, 243, 248, 1);
}
.highlight-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.highlight-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.highlight-red_background {
	background: rgba(253, 235, 236, 1);
}
.block-color-default {
	color: inherit;
	fill: inherit;
}
.block-color-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.block-color-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.block-color-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.block-color-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.block-color-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.block-color-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.block-color-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.block-color-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.block-color-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.block-color-default_background {
	color: inherit;
	fill: inherit;
}
.block-color-gray_background {
	background: rgba(241, 241, 239, 1);
}
.block-color-brown_background {
	background: rgba(244, 238, 238, 1);
}
.block-color-orange_background {
	background: rgba(251, 236, 221, 1);
}
.block-color-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.block-color-teal_background {
	background: rgba(237, 243, 236, 1);
}
.block-color-blue_background {
	background: rgba(231, 243, 248, 1);
}
.block-color-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.block-color-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.block-color-red_background {
	background: rgba(253, 235, 236, 1);
}
.select-value-color-uiBlue { background-color: rgba(35, 131, 226, .07); }
.select-value-color-pink { background-color: rgba(245, 224, 233, 1); }
.select-value-color-purple { background-color: rgba(232, 222, 238, 1); }
.select-value-color-green { background-color: rgba(219, 237, 219, 1); }
.select-value-color-gray { background-color: rgba(227, 226, 224, 1); }
.select-value-color-transparentGray { background-color: rgba(227, 226, 224, 0); }
.select-value-color-translucentGray { background-color: rgba(0, 0, 0, 0.06); }
.select-value-color-orange { background-color: rgba(250, 222, 201, 1); }
.select-value-color-brown { background-color: rgba(238, 224, 218, 1); }
.select-value-color-red { background-color: rgba(255, 226, 221, 1); }
.select-value-color-yellow { background-color: rgba(253, 236, 200, 1); }
.select-value-color-blue { background-color: rgba(211, 229, 239, 1); }
.select-value-color-pageGlass { background-color: undefined; }
.select-value-color-washGlass { background-color: undefined; }

.checkbox {
	display: inline-flex;
	vertical-align: text-bottom;
	width: 16;
	height: 16;
	background-size: 16px;
	margin-left: 2px;
	margin-right: 5px;
}

.checkbox-on {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22%2358A9D7%22%2F%3E%0A%3Cpath%20d%3D%22M6.71429%2012.2852L14%204.9995L12.7143%203.71436L6.71429%209.71378L3.28571%206.2831L2%207.57092L6.71429%2012.2852Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fsvg%3E");
}

.checkbox-off {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20x%3D%220.75%22%20y%3D%220.75%22%20width%3D%2214.5%22%20height%3D%2214.5%22%20fill%3D%22white%22%20stroke%3D%22%2336352F%22%20stroke-width%3D%221.5%22%2F%3E%0A%3C%2Fsvg%3E");
}
	
</style></head><body><article id="24810e64-0924-4159-a05f-9a78ca327633" class="page sans"><header><h1 class="page-title">IISを利用したリバースプロキシの構築</h1><p class="page-description"></p><table class="properties"><tbody><tr class="property-row property-row-multi_select"><th><span class="icon property-icon"><svg role="graphics-symbol" viewBox="0 0 16 16" style="width:14px;height:14px;display:block;fill:rgba(55, 53, 47, 0.45);flex-shrink:0" class="typesMultipleSelect"><path d="M1.91602 4.83789C2.44238 4.83789 2.87305 4.40723 2.87305 3.87402C2.87305 3.34766 2.44238 2.91699 1.91602 2.91699C1.38281 2.91699 0.952148 3.34766 0.952148 3.87402C0.952148 4.40723 1.38281 4.83789 1.91602 4.83789ZM5.1084 4.52344H14.3984C14.7607 4.52344 15.0479 4.23633 15.0479 3.87402C15.0479 3.51172 14.7607 3.22461 14.3984 3.22461H5.1084C4.74609 3.22461 4.45898 3.51172 4.45898 3.87402C4.45898 4.23633 4.74609 4.52344 5.1084 4.52344ZM1.91602 9.03516C2.44238 9.03516 2.87305 8.60449 2.87305 8.07129C2.87305 7.54492 2.44238 7.11426 1.91602 7.11426C1.38281 7.11426 0.952148 7.54492 0.952148 8.07129C0.952148 8.60449 1.38281 9.03516 1.91602 9.03516ZM5.1084 8.7207H14.3984C14.7607 8.7207 15.0479 8.43359 15.0479 8.07129C15.0479 7.70898 14.7607 7.42188 14.3984 7.42188H5.1084C4.74609 7.42188 4.45898 7.70898 4.45898 8.07129C4.45898 8.43359 4.74609 8.7207 5.1084 8.7207ZM1.91602 13.2324C2.44238 13.2324 2.87305 12.8018 2.87305 12.2686C2.87305 11.7422 2.44238 11.3115 1.91602 11.3115C1.38281 11.3115 0.952148 11.7422 0.952148 12.2686C0.952148 12.8018 1.38281 13.2324 1.91602 13.2324ZM5.1084 12.918H14.3984C14.7607 12.918 15.0479 12.6309 15.0479 12.2686C15.0479 11.9062 14.7607 11.6191 14.3984 11.6191H5.1084C4.74609 11.6191 4.45898 11.9062 4.45898 12.2686C4.45898 12.6309 4.74609 12.918 5.1084 12.918Z"></path></svg></span>タグ</th><td></td></tr></tbody></table></header><div class="page-body"><figure id="5c4b98dd-ff79-4878-97c2-ca4b88b5636f" class="image" style="text-align:left"><a href="../../AWS%20Knowledge%204ff04ac2d7b44dc18b787d5954b927a0/Onpremiss%20Active%20Directory%E3%82%92%E5%88%A9%E7%94%A8%E3%81%97%E3%81%A6AWS%20ADConnector%E3%81%A8%E6%8E%A5%E7%B6%9A%204825963019724601b93adaba7ad1b8d2/Windows_icon-icons.com_56585.png"><img style="width:240px" src="../../AWS%20Knowledge%204ff04ac2d7b44dc18b787d5954b927a0/Onpremiss%20Active%20Directory%E3%82%92%E5%88%A9%E7%94%A8%E3%81%97%E3%81%A6AWS%20ADConnector%E3%81%A8%E6%8E%A5%E7%B6%9A%204825963019724601b93adaba7ad1b8d2/Windows_icon-icons.com_56585.png"/></a></figure><p id="1abd0c38-3759-4f94-81d3-0e789a5d6f07" class="">目次</p><nav id="3b50f9a0-914f-44df-96e7-e963bc3df618" class="block-color-gray table_of_contents"><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#fd5eec7a-ca3d-44de-b751-6f63adc45495">はじめに</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#c157dcac-d86a-400e-ae7b-6d2d69fcc56a">IISのインストールとモジュールのインストール</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#1a29a896-ea99-44f4-b8c4-712936e7a131">IISのデフォルトウェブサイトでTestPageを作成</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#fa21de4e-345a-472e-9b2b-ea646e3b3675">HTTPSに対応するために自己証明書を作成</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#8d443c8c-fba4-4486-ab53-c520e9b8449e">Application Request Routing Cacheの有効化</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#b237b830-2812-45d9-9c47-30314d570df5">Rewrite機能でIISリバースプロキシの設定を実施</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#8f4f2cb0-134d-4602-8c54-113a5eceec01">Webページにアクセス</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#9c6d03dd-cbba-4361-bc37-6ac2446b45d5">IISのWebアクセスログの時刻表記修正</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#131899bb-b156-49fd-8d71-6ec7cb94e9ab">IISのWebアクセスログのローテーション</a></div></nav><h1 id="fd5eec7a-ca3d-44de-b751-6f63adc45495" class="">はじめに</h1><hr id="1289da9f-3730-8034-b53b-fb487a420069"/><p id="08843759-0858-4268-ae93-329c98948394" class="">IISを利用したリバースプロキシの構築方法を記載します。</p><h1 id="c157dcac-d86a-400e-ae7b-6d2d69fcc56a" class="">IISのインストールとモジュールのインストール</h1><hr id="1289da9f-3730-8023-998a-d24a3fe74f38"/><p id="cd70d55e-231f-40af-b454-a125033188b5" class="">サーバーマネージャーよりIISをインストールします。</p><p id="0ce8a191-3bb1-4338-ac00-909b8cbdaa75" class="">IISのインストール後にURL Rewriteモジュールを以下からダウンロードしてインストールします。</p><figure id="5db344c2-8efc-45eb-8788-021f2799ff3a"><a href="https://iis-umbraco.azurewebsites.net/downloads/microsoft/url-rewrite" class="bookmark source"><div class="bookmark-info"><div class="bookmark-text"><div class="bookmark-title">URL Rewrite : The Official Microsoft IIS Site</div><div class="bookmark-description">URL Rewrite allows Web administrators to easily build powerful rules using rewrite providers written in .NET, regular expression pattern matching, and wildcard mapping to examine information in both URLs and other HTTP headers and IIS server variables. Rules can be written to generate URLs that can be easier for users to remember, simple for search engines to index, and allow URLs to follow a consistent and canonical host name format. URL Rewrite further simplifies the rule creation process with support for content rewriting, rule templates, rewrite maps, rule validation, and import of existing mod_rewrite rules.</div></div><div class="bookmark-href"><img src="https://iis-umbraco.azurewebsites.net/favicon.ico" class="icon bookmark-icon"/>https://iis-umbraco.azurewebsites.net/downloads/microsoft/url-rewrite</div></div></a></figure><p id="ca7166d2-63ca-446c-ac5a-8c7dcbb40ad9" class="">次にApplication Request Routingをインストールします。</p><figure id="a9f90225-d1e0-4739-8a0d-3ab7be307241"><a href="https://www.iis.net/downloads/microsoft/application-request-routing" class="bookmark source"><div class="bookmark-info"><div class="bookmark-text"><div class="bookmark-title">Application Request Routing : The Official Microsoft IIS Site</div><div class="bookmark-description">HomeDownloadsMicrosoft Supported DownloadsApplication Request Routing</div></div><div class="bookmark-href"><img src="https://www.iis.net/favicon.ico" class="icon bookmark-icon"/>https://www.iis.net/downloads/microsoft/application-request-routing</div></div></a></figure><h1 id="1a29a896-ea99-44f4-b8c4-712936e7a131" class="">IISのデフォルトウェブサイトでTestPageを作成</h1><hr id="1289da9f-3730-8026-bb97-dbdf0f7466d5"/><p id="486f76ca-e67f-4fbd-b073-de45fe61d453" class="">規定のドキュメントからindex.htmlを最上位に移動します。</p><figure id="1209b5fe-ec4e-4a0d-9aac-cbbe294bae79" class="image" style="text-align:left"><a href="IIS%E3%82%92%E5%88%A9%E7%94%A8%E3%81%97%E3%81%9F%E3%83%AA%E3%83%8F%E3%82%99%E3%83%BC%E3%82%B9%E3%83%95%E3%82%9A%E3%83%AD%E3%82%AD%E3%82%B7%E3%81%AE%E6%A7%8B%E7%AF%89%2024810e6409244159a05f9a78ca327633/Untitled.png"><img style="width:912px" src="IIS%E3%82%92%E5%88%A9%E7%94%A8%E3%81%97%E3%81%9F%E3%83%AA%E3%83%8F%E3%82%99%E3%83%BC%E3%82%B9%E3%83%95%E3%82%9A%E3%83%AD%E3%82%AD%E3%82%B7%E3%81%AE%E6%A7%8B%E7%AF%89%2024810e6409244159a05f9a78ca327633/Untitled.png"/></a></figure><p id="56188a40-c906-4d5f-a082-b7643459177d" class="">C:\inetpub\wwwroot配下にindex.htmlでテストページを作成します。</p><figure id="050a0b73-e6e0-4521-8153-f18f2b1297cc" class="image" style="text-align:left"><a href="IIS%E3%82%92%E5%88%A9%E7%94%A8%E3%81%97%E3%81%9F%E3%83%AA%E3%83%8F%E3%82%99%E3%83%BC%E3%82%B9%E3%83%95%E3%82%9A%E3%83%AD%E3%82%AD%E3%82%B7%E3%81%AE%E6%A7%8B%E7%AF%89%2024810e6409244159a05f9a78ca327633/Untitled%201.png"><img style="width:690.0000610351562px" src="IIS%E3%82%92%E5%88%A9%E7%94%A8%E3%81%97%E3%81%9F%E3%83%AA%E3%83%8F%E3%82%99%E3%83%BC%E3%82%B9%E3%83%95%E3%82%9A%E3%83%AD%E3%82%AD%E3%82%B7%E3%81%AE%E6%A7%8B%E7%AF%89%2024810e6409244159a05f9a78ca327633/Untitled%201.png"/></a></figure><h1 id="fa21de4e-345a-472e-9b2b-ea646e3b3675" class="">HTTPSに対応するために自己証明書を作成</h1><hr id="1289da9f-3730-80ca-a9c4-cbeccbd3a721"/><p id="edfe7fa9-d7a7-4a2a-89c0-e32d54c2f0f3" class="">Powershellを使って自己署名証明書を作成します。(100年で作成しています。)</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1b0aa5b0-12d1-4776-8a19-2a4ff458b13d" class="code"><code class="language-JavaScript" style="white-space:pre-wrap;word-break:break-all">New-SelfSignedCertificate -Subject &quot;*.aws-actmotech.local&quot; -DnsName &quot;*.aws-actmotech.local&quot; -CertStoreLocation &quot;cert:\LocalMachine\My&quot; -KeyAlgorithm RSA -KeyLength 2048 -KeyExportPolicy Exportable -NotAfter (Get-Date).AddYears(100)</code></pre><p id="5da63104-19af-4013-a193-0c20e820f6e0" class="">コンピュータ証明書の管理を起動し、個人」→「証明書」フォルダをクリックします。</p><p id="98ada0a9-7c9d-49a6-8c59-baac4403ebc2" class="">作成した証明書を選択して、右クリックで「コピー」を選択します。</p><p id="818235c9-9368-4d5c-ab33-7dcc2a46dbd2" class="">[信頼されたルート証明機関]で［証明書］フォルダを右クリックで「貼り付け」を選択します。</p><figure id="1e1ab645-c49c-4970-b94b-9670b3f9c9c8" class="image" style="text-align:left"><a href="IIS%E3%82%92%E5%88%A9%E7%94%A8%E3%81%97%E3%81%9F%E3%83%AA%E3%83%8F%E3%82%99%E3%83%BC%E3%82%B9%E3%83%95%E3%82%9A%E3%83%AD%E3%82%AD%E3%82%B7%E3%81%AE%E6%A7%8B%E7%AF%89%2024810e6409244159a05f9a78ca327633/Untitled%202.png"><img style="width:816px" src="IIS%E3%82%92%E5%88%A9%E7%94%A8%E3%81%97%E3%81%9F%E3%83%AA%E3%83%8F%E3%82%99%E3%83%BC%E3%82%B9%E3%83%95%E3%82%9A%E3%83%AD%E3%82%AD%E3%82%B7%E3%81%AE%E6%A7%8B%E7%AF%89%2024810e6409244159a05f9a78ca327633/Untitled%202.png"/></a></figure><p id="e7444050-1d37-4a3b-b875-c3df73597349" class="">PowerShellで作成した自己署名証明書をIISで使用するためにサイト編集のバインド（右メニュー一覧）をクリックします。</p><p id="3703152c-d9ef-44bf-99ec-da5a335d5529" class="">httpsでバインドを追加します。</p><figure id="58ea321d-14a0-4d84-8a80-e03c56c8dca2" class="image" style="text-align:left"><a href="IIS%E3%82%92%E5%88%A9%E7%94%A8%E3%81%97%E3%81%9F%E3%83%AA%E3%83%8F%E3%82%99%E3%83%BC%E3%82%B9%E3%83%95%E3%82%9A%E3%83%AD%E3%82%AD%E3%82%B7%E3%81%AE%E6%A7%8B%E7%AF%89%2024810e6409244159a05f9a78ca327633/Untitled%203.png"><img style="width:623.9583740234375px" src="IIS%E3%82%92%E5%88%A9%E7%94%A8%E3%81%97%E3%81%9F%E3%83%AA%E3%83%8F%E3%82%99%E3%83%BC%E3%82%B9%E3%83%95%E3%82%9A%E3%83%AD%E3%82%AD%E3%82%B7%E3%81%AE%E6%A7%8B%E7%AF%89%2024810e6409244159a05f9a78ca327633/Untitled%203.png"/></a></figure><p id="6de04774-c3cd-4260-8a61-2c3579b86309" class="">テストページにアクセスします。</p><figure id="fc855871-636e-42dc-95fb-9a4e19a76b00" class="image" style="text-align:left"><a href="IIS%E3%82%92%E5%88%A9%E7%94%A8%E3%81%97%E3%81%9F%E3%83%AA%E3%83%8F%E3%82%99%E3%83%BC%E3%82%B9%E3%83%95%E3%82%9A%E3%83%AD%E3%82%AD%E3%82%B7%E3%81%AE%E6%A7%8B%E7%AF%89%2024810e6409244159a05f9a78ca327633/Untitled%204.png"><img style="width:568.9409790039062px" src="IIS%E3%82%92%E5%88%A9%E7%94%A8%E3%81%97%E3%81%9F%E3%83%AA%E3%83%8F%E3%82%99%E3%83%BC%E3%82%B9%E3%83%95%E3%82%9A%E3%83%AD%E3%82%AD%E3%82%B7%E3%81%AE%E6%A7%8B%E7%AF%89%2024810e6409244159a05f9a78ca327633/Untitled%204.png"/></a></figure><p id="e00f2b22-542c-4eac-a52d-93eb0f82ba60" class="">作成した自己証明書を他のサーバで利用したい場合などは、コンピュータ証明書の管理を起動し、個人」→「証明書」フォルダをクリックします。</p><p id="c3bff435-93b4-43aa-8558-b20003c0e3d9" class="">作成した証明書を選択して、右クリックで「すべてのタスク」→「エクスポート」します。</p><p id="cfd845d1-15b5-40a5-874b-817fca2ed887" class="">※秘密キーもエクスポートしてください。</p><p id="2852d802-c3a6-4ce1-9dbd-d34eac435a4d" class="">エクスポートする際にパスワード入力する必要があるので入力し、保存先に保存します。</p><p id="5924d693-046c-4bd6-b2ed-d3215204da82" class="">保存したpfxファイルから以下コマンドを用いて秘密鍵と証明書ファイルをエクスポートします。</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="2940d5f1-5ab5-4422-9529-231811b502ac" class="code"><code class="language-JavaScript" style="white-space:pre-wrap;word-break:break-all"># openssl pkcs12 -in aws-actmotech.local.pfx -nocerts -nodes -out aws-actmotech.local.key
# openssl pkcs12 -in aws-actmotech.local.pfx -clcerts -nokeys -out aws-actmotech.local.crt</code></pre><h1 id="8d443c8c-fba4-4486-ab53-c520e9b8449e" class="">Application Request Routing Cacheの有効化</h1><hr id="1289da9f-3730-80ad-976b-e660acff68fc"/><p id="008a137c-88d1-4f3d-98a0-c90e2b301555" class="">Application Request Routing Cacheをクリックします。</p><figure id="d43fe24b-ebd7-44b5-adac-22f881cb296a" class="image" style="text-align:left"><a href="IIS%E3%82%92%E5%88%A9%E7%94%A8%E3%81%97%E3%81%9F%E3%83%AA%E3%83%8F%E3%82%99%E3%83%BC%E3%82%B9%E3%83%95%E3%82%9A%E3%83%AD%E3%82%AD%E3%82%B7%E3%81%AE%E6%A7%8B%E7%AF%89%2024810e6409244159a05f9a78ca327633/Untitled%205.png"><img style="width:532.951416015625px" src="IIS%E3%82%92%E5%88%A9%E7%94%A8%E3%81%97%E3%81%9F%E3%83%AA%E3%83%8F%E3%82%99%E3%83%BC%E3%82%B9%E3%83%95%E3%82%9A%E3%83%AD%E3%82%AD%E3%82%B7%E3%81%AE%E6%A7%8B%E7%AF%89%2024810e6409244159a05f9a78ca327633/Untitled%205.png"/></a></figure><p id="c53c6b8d-edd1-4b16-b6db-ab7dcf83a59b" class="">EnableProxyのチェックボックスにチェックを入れます。</p><figure id="215e6000-93bc-4f43-bb51-4ef930e1a317" class="image" style="text-align:left"><a href="IIS%E3%82%92%E5%88%A9%E7%94%A8%E3%81%97%E3%81%9F%E3%83%AA%E3%83%8F%E3%82%99%E3%83%BC%E3%82%B9%E3%83%95%E3%82%9A%E3%83%AD%E3%82%AD%E3%82%B7%E3%81%AE%E6%A7%8B%E7%AF%89%2024810e6409244159a05f9a78ca327633/Untitled%206.png"><img style="width:432px" src="IIS%E3%82%92%E5%88%A9%E7%94%A8%E3%81%97%E3%81%9F%E3%83%AA%E3%83%8F%E3%82%99%E3%83%BC%E3%82%B9%E3%83%95%E3%82%9A%E3%83%AD%E3%82%AD%E3%82%B7%E3%81%AE%E6%A7%8B%E7%AF%89%2024810e6409244159a05f9a78ca327633/Untitled%206.png"/></a></figure><h1 id="b237b830-2812-45d9-9c47-30314d570df5" class="">Rewrite機能でIISリバースプロキシの設定を実施</h1><hr id="1289da9f-3730-8034-9278-ea692caab647"/><p id="bb25d183-bc7b-4475-af25-d5d86036e3ba" class="">URL書き換えルールを作成します。</p><p id="5a07beaf-46af-41fa-88ea-87ab1aade18b" class="">規則の追加で規則テンプレート内の受信規則からからの規則を選択してOKをクリックします。</p><p id="b64be67e-c071-4a16-bf9a-98c4272af5f3" class="">作成するルール内容としては特定のホストヘッダーがあれば対象のURLにリダイレクト先に転送するをやりたいと思います。</p><ul id="a0be4abf-955d-4643-b27f-8937e0d96028" class="bulleted-list"><li style="list-style-type:disc">名前を入力をします。</li></ul><ul id="96d04819-1546-450a-9648-85728bdf6212" class="bulleted-list"><li style="list-style-type:disc">正規表現パターンとしては(.*)とします。</li></ul><ul id="cd059076-2320-4a1e-adca-07c24aefba4c" class="bulleted-list"><li style="list-style-type:disc">条件には入力に{HTTP_HOST}、種類にパターンに一致する、パターンにHTTPホストヘッダーの内容を記載します。</li></ul><ul id="24b56a6a-8440-42e8-bcde-b925d90d2864" class="bulleted-list"><li style="list-style-type:disc">アクション種類は書き換えにします。</li></ul><ul id="6e41621b-1466-4634-b48a-d4da1a5cd81f" class="bulleted-list"><li style="list-style-type:disc">リダイレクト先のURLを記載します。(http://ドメイン名もしくはIPアドレス/{R:0})</li></ul><h1 id="8f4f2cb0-134d-4602-8c54-113a5eceec01" class="">Webページにアクセス</h1><hr id="1289da9f-3730-806d-b9fb-c04f3ecee571"/><p id="2577d662-12c6-4c46-94d5-0d88c4a826dd" class="">アクセスするとバックエンドで用意したWEBサーバの画面が表示されて、かつHTTPSでアクセスができればOKです。</p><h1 id="9c6d03dd-cbba-4361-bc37-6ac2446b45d5" class="">IISのWebアクセスログの時刻表記修正</h1><hr id="1289da9f-3730-8059-9992-ed99b134ab23"/><p id="9c96abcd-87af-49a7-8c90-0590a522911c" class="">ログ記録のデフォルト形式はW3Cとなっており、UTC時刻で書き込みがされています。</p><p id="dff9e34a-797a-4e32-8a0c-1aa69fc1d445" class="">IIS形式にすることでJST時刻に切り替えられます。</p><figure id="44ded6a3-4698-4dda-b3bb-28755ffcdb7b" class="image" style="text-align:left"><a href="IIS%E3%82%92%E5%88%A9%E7%94%A8%E3%81%97%E3%81%9F%E3%83%AA%E3%83%8F%E3%82%99%E3%83%BC%E3%82%B9%E3%83%95%E3%82%9A%E3%83%AD%E3%82%AD%E3%82%B7%E3%81%AE%E6%A7%8B%E7%AF%89%2024810e6409244159a05f9a78ca327633/Untitled%207.png"><img style="width:576px" src="IIS%E3%82%92%E5%88%A9%E7%94%A8%E3%81%97%E3%81%9F%E3%83%AA%E3%83%8F%E3%82%99%E3%83%BC%E3%82%B9%E3%83%95%E3%82%9A%E3%83%AD%E3%82%AD%E3%82%B7%E3%81%AE%E6%A7%8B%E7%AF%89%2024810e6409244159a05f9a78ca327633/Untitled%207.png"/></a></figure><h1 id="131899bb-b156-49fd-8d71-6ec7cb94e9ab" class="">IISのWebアクセスログのローテーション</h1><hr id="1289da9f-3730-8012-b3c8-ed3f49da2aff"/><p id="155ecd4d-0567-47e9-9ee0-585f9c915cec" class="">IISのアクセスログは標準では削除する機能はありません。</p><p id="ecd43029-04e1-4a2c-ae6e-635a75aa889b" class="">タスクスケジューラーで以下コマンドが実行されるようにします。</p><p id="b2c413bf-bcc8-48da-b67e-16c1182d24c8" class="">以下の内容はログの位置が「C:\inetpub\logs\LogFiles」にあり、「90」日以前のログを削除する内容になります。</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="8c568217-9224-49f9-a82d-d3ef6fe31489" class="code"><code class="language-JavaScript" style="white-space:pre-wrap;word-break:break-all">forfiles /p “C:\inetpub\logs\LogFiles” /s /m *.* /c “cmd /c Del @path” /d -90</code></pre><p id="af0a427f-90e6-44c0-be66-0a5d4dafb65c" class="">
</p><p id="c58c4326-0015-4706-b4e8-9a15818eeed9" class="">
</p></div></article><span class="sans" style="font-size:14px;padding-top:2em"></span></body></html>